(()=>{"use strict";class t{static patchChildren(t,e,s){t.childNodes.forEach(((t,a)=>{this.patchNode(t,e[a],s[a])})),s.slice(e.length).forEach((e=>{t.appendChild(this.createDOMNode(e))}))}static patchProp(t,e,s,a){if(null!=a&&!1!==a){if(e.startsWith("on")){const r=e.slice(2);return t[r]=a,void(a?s||t.addEventListener(r,this.#t):t.removeEventListener(r,this.#t))}t.setAttribute(e,a)}else t.removeAttribute(e)}static patchProps(t,e,s){const a={...e,...s};Object.keys(a).forEach((a=>{e[a]!==s[a]&&this.patchProp(t,a,e[a],s[a])}))}static patchNode(t,e,s){if(void 0!==s){if("string"==typeof e||"string"==typeof s){if(e!==s){const e=this.createDOMNode(s);return t.replaceWith(e),e}return t}if(e.tagName!==s.tagName){const e=this.createDOMNode(s);return t.replaceWith(e),e}return this.patchProps(t,e.props,s.props),this.patchChildren(t,e.children,s.children),t}t.remove()}static createDOMNode(t){if("string"==typeof t)return document.createTextNode(t);const{tagName:e,props:s,children:a}=t,r=document.createElement(e);return this.patchProps(r,{},s),a.forEach((t=>{r.appendChild(this.createDOMNode(t))})),r}static createVNode(t,e={},s=[]){return{tagName:t,props:e,children:s}}static mount(t,e){return e.replaceWith(t),t}static patch(t,e){const s=e.v||this.#e(e);return(e=this.patchNode(e,s,t)).v=t,e}static#e(t){if(3===t.nodeType)return t.nodeValue;const e=t.nodeName.toLowerCase(),s=[].map.call(t.childNodes,this.#e);return this.createVNode(e,{},s)}static#t(t){return this[t.type](t)}}class e{constructor(t){this.app=t,this.state={selectedRow:0,rows:["Start","Options"]}}onStateChanged(){t.patch(this.createVApp(this.store),this.app)}createVApp(){const{selectedRow:e,rows:s}=this.state,a=s.map(((s,a)=>{const r=a===e?"menu__item menu__item_selected":"menu__item";return t.createVNode("p",{class:r,tabindex:1,onclick:t=>{this.setState("changeSelectedRow",a)}},[s])}));return t.createVNode("div",{class:"menu",onkeydown:t=>{console.log("KEYDOWN",t)}},a)}setState(t,e){"changeSelectedRow"===t&&(this.state.selectedRow=e,"ArrowUp"===e&&this.state.selectedRow-1<0&&(this.state.selectedRow=this.state.rows.length-1),"ArrowDown"===e&&this.state.selectedRow+1>this.state.rows.length-1&&(this.state.selectedRow=0),this.onStateChanged())}}Object.freeze({RIGHT:Symbol("RIGHT"),LEFT:Symbol("LEFT"),UP:Symbol("UP"),DOWN:Symbol("DOWN")});const s=Object.freeze({MENU:Symbol("MENU"),GAME:Symbol("GAME")});new class{constructor(){this.state=s.MENU,this.app=document.getElementById("root"),this[s.MENU]=new e(this.app);const a=this[this.state].createVApp();this.app=t.patch(a,this.app)}onStateChanged(){this[this.state].createVApp(),t.patch(createVApp(this.store),app)}setState(t){this.state=t,this.onStateChanged()}}})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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S0FBTUQsT0FBTyxRQUNiRSxHQUFJRixPQUFPLE1BQ1hHLEtBQU1ILE9BQU8sVUNSZixNQUFNSSxFQUFXeEQsT0FBT2tELE9BQU8sQ0FDN0JPLEtBQU1MLE9BQU8sUUFDYk0sS0FBTU4sT0FBTyxVQTJCRixJQXhCYixNQUNFdkIsY0FDRWpELEtBQUttRCxNQUFReUIsRUFBU0MsS0FDdEI3RSxLQUFLa0QsSUFBTWpCLFNBQVM4QyxlQUFlLFFBQ25DL0UsS0FBSzRFLEVBQVNDLE1BQVEsSUFBSSxFQUFLN0UsS0FBS2tELEtBQ3BDLE1BQU04QixFQUFXaEYsS0FBS0EsS0FBS21ELE9BQU9LLGFBQ2xDeEQsS0FBS2tELElBQU0zRCxFQUFLZ0UsTUFBTXlCLEVBQVVoRixLQUFLa0QsSUFDdkMsQ0FFQUksaUJBQ0V0RCxLQUFLQSxLQUFLbUQsT0FBT0ssYUFDakJqRSxFQUFLZ0UsTUFBTUMsV0FBV3hELEtBQUt5RCxPQUFRUCxJQUNyQyxDQUVBZSxTQUFTZ0IsR0FDUGpGLEtBQUttRCxNQUFROEIsRUFDYmpGLEtBQUtzRCxnQkFDUCxFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc25ha2UvLi9zcmMvdmRvbS5qcyIsIndlYnBhY2s6Ly9zbmFrZS8uL3NyYy9tZW51LmpzIiwid2VicGFjazovL3NuYWtlLy4vc3JjL2dhbWUuanMiLCJ3ZWJwYWNrOi8vc25ha2UvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgVEVYVF9OT0RFX1RZUEUgPSAzO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVkRPTSB7XHJcbiAgc3RhdGljIHBhdGNoQ2hpbGRyZW4ocGFyZW50LCB2Q2hpbGRyZW4sIG5leHRWQ2hpbGRyZW4pIHtcclxuICAgIHBhcmVudC5jaGlsZE5vZGVzLmZvckVhY2goKGNoaWxkTm9kZSwgaSkgPT4ge1xyXG4gICAgICB0aGlzLnBhdGNoTm9kZShjaGlsZE5vZGUsIHZDaGlsZHJlbltpXSwgbmV4dFZDaGlsZHJlbltpXSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBuZXh0VkNoaWxkcmVuLnNsaWNlKHZDaGlsZHJlbi5sZW5ndGgpLmZvckVhY2goKHZDaGlsZCkgPT4ge1xyXG4gICAgICBwYXJlbnQuYXBwZW5kQ2hpbGQodGhpcy5jcmVhdGVET01Ob2RlKHZDaGlsZCkpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgcGF0Y2hQcm9wKG5vZGUsIGtleSwgdmFsdWUsIG5leHRWYWx1ZSkge1xyXG4gICAgLy8g0JXRgdC70Lgg0L3QvtCy0L7QtSDQt9C90LDRh9C10L3QuNC1INC90LUg0LfQsNC00LDQvdC+LCDRgtC+INGD0LTQsNC70Y/QtdC8INCw0YLRgNC40LHRg9GCXHJcbiAgICBpZiAobmV4dFZhbHVlID09IG51bGwgfHwgbmV4dFZhbHVlID09PSBmYWxzZSkge1xyXG4gICAgICBub2RlLnJlbW92ZUF0dHJpYnV0ZShrZXkpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGtleS5zdGFydHNXaXRoKFwib25cIikpIHtcclxuICAgICAgY29uc3QgZXZlbnROYW1lID0ga2V5LnNsaWNlKDIpO1xyXG5cclxuICAgICAgbm9kZVtldmVudE5hbWVdID0gbmV4dFZhbHVlO1xyXG4gICAgICAvLyBjb25zb2xlLmxvZyhub2RlLCBrZXksIHZhbHVlLCBuZXh0VmFsdWUpO1xyXG4gICAgICBpZiAoIW5leHRWYWx1ZSkge1xyXG4gICAgICAgIG5vZGUucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIHRoaXMuI2xpc3RlbmVyKTtcclxuICAgICAgfSBlbHNlIGlmICghdmFsdWUpIHtcclxuICAgICAgICBub2RlLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCB0aGlzLiNsaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgLy8g0KPRgdGC0LDQvdCw0LLQu9C40LLQsNC10Lwg0L3QvtCy0L7QtSDQt9C90LDRh9C10L3QuNC1INCw0YLRgNC40LHRg9GC0LBcclxuICAgIG5vZGUuc2V0QXR0cmlidXRlKGtleSwgbmV4dFZhbHVlKTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBwYXRjaFByb3BzKG5vZGUsIHByb3BzLCBuZXh0UHJvcHMpIHtcclxuICAgIC8vINCe0LHRitC10LrRgiDRgSDQvtCx0YnQuNC80Lgg0YHQstC+0LnRgdGC0LLQsNC80LhcclxuICAgIGNvbnN0IG1lcmdlZFByb3BzID0geyAuLi5wcm9wcywgLi4ubmV4dFByb3BzIH07XHJcblxyXG4gICAgT2JqZWN0LmtleXMobWVyZ2VkUHJvcHMpLmZvckVhY2goKGtleSkgPT4ge1xyXG4gICAgICAvLyDQldGB0LvQuCDQt9C90LDRh9C10L3QuNC1INC90LUg0LjQt9C80LXQvdC40LvQvtGB0YwsINGC0L4g0L3QuNGH0LXQs9C+INC90LUg0L7QsdC90L7QstC70Y/QtdC8XHJcbiAgICAgIGlmIChwcm9wc1trZXldICE9PSBuZXh0UHJvcHNba2V5XSkge1xyXG4gICAgICAgIHRoaXMucGF0Y2hQcm9wKG5vZGUsIGtleSwgcHJvcHNba2V5XSwgbmV4dFByb3BzW2tleV0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBwYXRjaE5vZGUobm9kZSwgdk5vZGUsIG5leHRWTm9kZSkge1xyXG4gICAgLy8g0KPQtNCw0LvRj9C10Lwg0L3QvtC00YMsINC10YHQu9C4INC30L3QsNGH0LXQvdC40LUgbmV4dFZOb2RlINC90LUg0LfQsNC00LDQvdC+XHJcbiAgICBpZiAobmV4dFZOb2RlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgbm9kZS5yZW1vdmUoKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0eXBlb2Ygdk5vZGUgPT09IFwic3RyaW5nXCIgfHwgdHlwZW9mIG5leHRWTm9kZSA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAvLyDQl9Cw0LzQtdC90Y/QtdC8INC90L7QtNGDINC90LAg0L3QvtCy0YPRjiwg0LXRgdC70Lgg0LrQsNC6INC80LjQvdC40LzRg9C8INC+0LTQvdC+INC40Lcg0LfQvdCw0YfQtdC90LjQuSDRgNCw0LLQvdC+INGB0YLRgNC+0LrQtVxyXG4gICAgICAvLyDQuCDRjdGC0Lgg0LfQvdCw0YfQtdC90LjRjyDQvdC1INGA0LDQstC90Ysg0LTRgNGD0LMg0LTRgNGD0LPRg1xyXG4gICAgICBpZiAodk5vZGUgIT09IG5leHRWTm9kZSkge1xyXG4gICAgICAgIGNvbnN0IG5leHROb2RlID0gdGhpcy5jcmVhdGVET01Ob2RlKG5leHRWTm9kZSk7XHJcbiAgICAgICAgbm9kZS5yZXBsYWNlV2l0aChuZXh0Tm9kZSk7XHJcbiAgICAgICAgcmV0dXJuIG5leHROb2RlO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyDQldGB0LvQuCDQtNCy0LAg0LfQvdCw0YfQtdC90LjRjyAtINGN0YLQviDRgdGC0YDQvtC60Lgg0Lgg0L7QvdC4INGA0LDQstC90YssXHJcbiAgICAgIC8vINC/0YDQvtGB0YLQviDQstC+0LfQstGA0LDRidCw0LXQvCDRgtC10LrRg9GJ0YPRjiDQvdC+0LTRg1xyXG4gICAgICByZXR1cm4gbm9kZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDQl9Cw0LzQtdC90Y/QtdC8INC90L7QtNGDINC90LAg0L3QvtCy0YPRjiwg0LXRgdC70Lgg0YLQtdCz0Lgg0L3QtSDRgNCw0LLQvdGLXHJcbiAgICBpZiAodk5vZGUudGFnTmFtZSAhPT0gbmV4dFZOb2RlLnRhZ05hbWUpIHtcclxuICAgICAgY29uc3QgbmV4dE5vZGUgPSB0aGlzLmNyZWF0ZURPTU5vZGUobmV4dFZOb2RlKTtcclxuICAgICAgbm9kZS5yZXBsYWNlV2l0aChuZXh0Tm9kZSk7XHJcbiAgICAgIHJldHVybiBuZXh0Tm9kZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDQn9Cw0YLRh9C40Lwg0YHQstC+0LnRgdGC0LLQsFxyXG4gICAgdGhpcy5wYXRjaFByb3BzKG5vZGUsIHZOb2RlLnByb3BzLCBuZXh0Vk5vZGUucHJvcHMpO1xyXG5cclxuICAgIC8vINCf0LDRgtGH0LjQvCDQtNC10YLQtdC5XHJcbiAgICB0aGlzLnBhdGNoQ2hpbGRyZW4obm9kZSwgdk5vZGUuY2hpbGRyZW4sIG5leHRWTm9kZS5jaGlsZHJlbik7XHJcblxyXG4gICAgLy8g0JLQvtC30LLRgNCw0YnQsNC10Lwg0L7QsdC90L7QstC70LXQvdC90YvQuSBET00t0Y3Qu9C10LzQtdC90YJcclxuICAgIHJldHVybiBub2RlO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGNyZWF0ZURPTU5vZGUodk5vZGUpIHtcclxuICAgIGlmICh0eXBlb2Ygdk5vZGUgPT09IFwic3RyaW5nXCIpIHtcclxuICAgICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHZOb2RlKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IHRhZ05hbWUsIHByb3BzLCBjaGlsZHJlbiB9ID0gdk5vZGU7XHJcblxyXG4gICAgY29uc3Qgbm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnTmFtZSk7XHJcbiAgICB0aGlzLnBhdGNoUHJvcHMobm9kZSwge30sIHByb3BzKTtcclxuXHJcbiAgICBjaGlsZHJlbi5mb3JFYWNoKChjaGlsZCkgPT4ge1xyXG4gICAgICBub2RlLmFwcGVuZENoaWxkKHRoaXMuY3JlYXRlRE9NTm9kZShjaGlsZCkpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIG5vZGU7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgY3JlYXRlVk5vZGUodGFnTmFtZSwgcHJvcHMgPSB7fSwgY2hpbGRyZW4gPSBbXSkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgdGFnTmFtZSxcclxuICAgICAgcHJvcHMsXHJcbiAgICAgIGNoaWxkcmVuLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBtb3VudChub2RlLCB0YXJnZXQpIHtcclxuICAgIHRhcmdldC5yZXBsYWNlV2l0aChub2RlKTtcclxuICAgIHJldHVybiBub2RlO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIHBhdGNoKG5leHRWTm9kZSwgbm9kZSkge1xyXG4gICAgLy8g0J/QvtC70YPRh9Cw0LXQvCDRgtC10LrRg9GJ0LXQtSDQstC40YDRgtGD0LDQu9GM0L3QvtC1INC00LXRgNC10LLQviDQuNC3IERPTS3QvdC+0LTRi1xyXG4gICAgY29uc3Qgdk5vZGUgPSBub2RlLnYgfHwgdGhpcy4jcmVjeWNsZU5vZGUobm9kZSk7XHJcbiAgICAvLyDQn9Cw0YLRh9C40LwgRE9NLdC90L7QtNGDXHJcbiAgICBub2RlID0gdGhpcy5wYXRjaE5vZGUobm9kZSwgdk5vZGUsIG5leHRWTm9kZSk7XHJcbiAgICAvLyDQodC+0YXRgNCw0L3Rj9C10Lwg0LLQuNGA0YLRg9Cw0LvRjNC90L7QtSDQtNC10YDQtdCy0L4g0LIgRE9NLdC90L7QtNGDXHJcbiAgICBub2RlLnYgPSBuZXh0Vk5vZGU7XHJcblxyXG4gICAgcmV0dXJuIG5vZGU7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgI3JlY3ljbGVOb2RlKG5vZGUpIHtcclxuICAgIC8vINCV0YHQu9C4INGC0LXQutGB0YLQvtCy0LDRjyDQvdC+0LTQsCAtINGC0L4g0LLQvtC30LLRgNCw0YnQsNC10Lwg0YLQtdC60YHRglxyXG4gICAgaWYgKG5vZGUubm9kZVR5cGUgPT09IFRFWFRfTk9ERV9UWVBFKSB7XHJcbiAgICAgIHJldHVybiBub2RlLm5vZGVWYWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyAg0J/QvtC70YPRh9Cw0LXQvCDQuNC80Y8g0YLQtdCz0LBcclxuICAgIGNvbnN0IHRhZ05hbWUgPSBub2RlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7XHJcblxyXG4gICAgLy8g0KDQtdC60YPRgNGB0LjQstC90L4g0L7QsdGA0LDQsdCw0YLRi9Cy0LDQtdC8INC00L7Rh9C10YDQvdC40LUg0L3QvtC00YtcclxuICAgIGNvbnN0IGNoaWxkcmVuID0gW10ubWFwLmNhbGwobm9kZS5jaGlsZE5vZGVzLCB0aGlzLiNyZWN5Y2xlTm9kZSk7XHJcblxyXG4gICAgLy8g0KHQvtC30LTQsNC10Lwg0LLQuNGA0YLRg9Cw0LvRjNC90YPRjiDQvdC+0LTRg1xyXG4gICAgcmV0dXJuIHRoaXMuY3JlYXRlVk5vZGUodGFnTmFtZSwge30sIGNoaWxkcmVuKTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyAjbGlzdGVuZXIoZXZlbnQpIHtcclxuICAgIHJldHVybiB0aGlzW2V2ZW50LnR5cGVdKGV2ZW50KTtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IFZET00gZnJvbSBcIi4vdmRvbVwiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTWVudVN0YXRlIHtcclxuICBjb25zdHJ1Y3RvcihhcHApIHtcclxuICAgIHRoaXMuYXBwID0gYXBwO1xyXG4gICAgdGhpcy5zdGF0ZSA9IHtcclxuICAgICAgc2VsZWN0ZWRSb3c6IDAsXHJcbiAgICAgIHJvd3M6IFtcIlN0YXJ0XCIsIFwiT3B0aW9uc1wiXSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBvblN0YXRlQ2hhbmdlZCgpIHtcclxuICAgIFZET00ucGF0Y2godGhpcy5jcmVhdGVWQXBwKHRoaXMuc3RvcmUpLCB0aGlzLmFwcCk7XHJcbiAgfVxyXG5cclxuICBjcmVhdGVWQXBwKCkge1xyXG4gICAgY29uc3QgeyBzZWxlY3RlZFJvdywgcm93cyB9ID0gdGhpcy5zdGF0ZTtcclxuICAgIGNvbnN0IGh0bWxNZW51Um93cyA9IHJvd3MubWFwKChpdGVtLCBpbmRleCkgPT4ge1xyXG4gICAgICBjb25zdCBjbGFzc05hbWUgPVxyXG4gICAgICAgIGluZGV4ID09PSBzZWxlY3RlZFJvdyA/IFwibWVudV9faXRlbSBtZW51X19pdGVtX3NlbGVjdGVkXCIgOiBcIm1lbnVfX2l0ZW1cIjtcclxuICAgICAgcmV0dXJuIFZET00uY3JlYXRlVk5vZGUoXHJcbiAgICAgICAgXCJwXCIsXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgY2xhc3M6IGNsYXNzTmFtZSxcclxuICAgICAgICAgIHRhYmluZGV4OiAxLFxyXG4gICAgICAgICAgLy8gb25rZXlkb3duOiAoZXZlbnQpID0+IHtcclxuICAgICAgICAgIC8vICAgY29uc29sZS5sb2coXCJLRVlET1dOXCIsIGV2ZW50KTtcclxuICAgICAgICAgIC8vIH0sXHJcbiAgICAgICAgICBvbmNsaWNrOiAoZXZlbnQpID0+IHtcclxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJFVkVOVDogXCIsIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpO1xyXG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKFwiY2hhbmdlU2VsZWN0ZWRSb3dcIiwgaW5kZXgpO1xyXG4gICAgICAgICAgICAvLyBzd2l0Y2ggKGV2ZW50LmtleSkge1xyXG4gICAgICAgICAgICAvLyAgIGNhc2UgXCJBcnJvd1VwXCI6IHtcclxuICAgICAgICAgICAgLy8gICAgIHRoaXMuc2V0U3RhdGUoXCJjaGFuZ2VTZWxlY3RlZFJvd1wiLCBpbmRleCk7XHJcbiAgICAgICAgICAgIC8vICAgICBicmVhaztcclxuICAgICAgICAgICAgLy8gICB9XHJcbiAgICAgICAgICAgIC8vICAgY2FzZSBcIkFycm93RG93blwiOiB7XHJcbiAgICAgICAgICAgIC8vICAgICB0aGlzLnNldFN0YXRlKFwiY2hhbmdlU2VsZWN0ZWRSb3dcIiwgaW5kZXgpO1xyXG4gICAgICAgICAgICAvLyAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIC8vICAgfVxyXG4gICAgICAgICAgICAvLyAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIC8vICAgICBicmVhaztcclxuICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgfSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIFtpdGVtXVxyXG4gICAgICApO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gVkRPTS5jcmVhdGVWTm9kZShcclxuICAgICAgXCJkaXZcIixcclxuICAgICAge1xyXG4gICAgICAgIGNsYXNzOiBcIm1lbnVcIixcclxuICAgICAgICBvbmtleWRvd246IChldmVudCkgPT4ge1xyXG4gICAgICAgICAgY29uc29sZS5sb2coXCJLRVlET1dOXCIsIGV2ZW50KTtcclxuICAgICAgICB9LFxyXG4gICAgICB9LFxyXG4gICAgICBodG1sTWVudVJvd3NcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBzZXRTdGF0ZShhY3Rpb24sIHZhbHVlKSB7XHJcbiAgICBpZiAoYWN0aW9uID09PSBcImNoYW5nZVNlbGVjdGVkUm93XCIpIHtcclxuICAgICAgdGhpcy5zdGF0ZS5zZWxlY3RlZFJvdyA9IHZhbHVlO1xyXG4gICAgICBpZiAodmFsdWUgPT09IFwiQXJyb3dVcFwiKSB7XHJcbiAgICAgICAgY29uc3QgbmV3U3RhdGUgPSB0aGlzLnN0YXRlLnNlbGVjdGVkUm93IC0gMTtcclxuICAgICAgICBpZiAobmV3U3RhdGUgPCAwKSB7XHJcbiAgICAgICAgICB0aGlzLnN0YXRlLnNlbGVjdGVkUm93ID0gdGhpcy5zdGF0ZS5yb3dzLmxlbmd0aCAtIDE7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIGlmICh2YWx1ZSA9PT0gXCJBcnJvd0Rvd25cIikge1xyXG4gICAgICAgIGNvbnN0IG5ld1N0YXRlID0gdGhpcy5zdGF0ZS5zZWxlY3RlZFJvdyArIDE7XHJcbiAgICAgICAgaWYgKG5ld1N0YXRlID4gdGhpcy5zdGF0ZS5yb3dzLmxlbmd0aCAtIDEpIHtcclxuICAgICAgICAgIHRoaXMuc3RhdGUuc2VsZWN0ZWRSb3cgPSAwO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICB0aGlzLm9uU3RhdGVDaGFuZ2VkKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBzZXRIYW5kbGVyKCkge1xyXG4gIC8vICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGV2ZW50KSA9PiB7XHJcbiAgLy8gICAgIHN3aXRjaCAoZXZlbnQua2V5KSB7XHJcbiAgLy8gICAgICAgY2FzZSBcIkFycm93VXBcIjoge1xyXG4gIC8vICAgICAgICAgdGhpcy5zZXRTdGF0ZShcImNoYW5nZVNlbGVjdGVkUm93XCIsIFwiQXJyb3dVcFwiKTtcclxuICAvLyAgICAgICAgIGJyZWFrO1xyXG4gIC8vICAgICAgIH1cclxuICAvLyAgICAgICBjYXNlIFwiQXJyb3dEb3duXCI6IHtcclxuICAvLyAgICAgICAgIHRoaXMuc2V0U3RhdGUoXCJjaGFuZ2VTZWxlY3RlZFJvd1wiLCBcIkFycm93RG93blwiKTtcclxuICAvLyAgICAgICAgIGJyZWFrO1xyXG4gIC8vICAgICAgIH1cclxuICAvLyAgICAgICBkZWZhdWx0OlxyXG4gIC8vICAgICAgICAgYnJlYWs7XHJcbiAgLy8gICAgIH1cclxuICAvLyAgIH0pO1xyXG4gIC8vIH1cclxuICAvLyByZW1vdmVIYW5kbGVyKCkge1xyXG4gIC8vICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIik7XHJcbiAgLy8gfVxyXG59XHJcbiIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuLy8gMTAgeCAxMFxyXG5cclxuLy8geDEseTEgeDIseTEuLi5cclxuLy8geDEseTIgeDIseTIuLi5cclxuLy8gMCAwIDAgMCAwIDAgMCAwIDBcclxuLy8gLi4uXHJcbi8vIDVyb3csIDQsNSw2IGVsZW1cclxuXHJcbmNvbnN0IERJUkVDVElPTiA9IE9iamVjdC5mcmVlemUoe1xyXG4gIFJJR0hUOiBTeW1ib2woXCJSSUdIVFwiKSxcclxuICBMRUZUOiBTeW1ib2woXCJMRUZUXCIpLFxyXG4gIFVQOiBTeW1ib2woXCJVUFwiKSxcclxuICBET1dOOiBTeW1ib2woXCJET1dOXCIpLFxyXG59KTtcclxuXHJcbi8vIGZyb20gMCB0b1xyXG5jb25zdCBncmlkSGVpZ2h0ID0gMTE7XHJcbmNvbnN0IGdyaWRXaWR0aCA9IDExO1xyXG5jb25zdCBncmlkSWQgPSBcImdhbWVHcmlkXCI7XHJcblxyXG5jbGFzcyBHcmlkIHtcclxuICBjb25zdHJ1Y3Rvcih3aWR0aCwgaGVpZ2h0KSB7XHJcbiAgICB0aGlzLndpZHRoID0gd2lkdGg7XHJcbiAgICB0aGlzLmhlaWdodCA9IGhlaWdodDtcclxuICB9XHJcblxyXG4gIGlzT3V0T2ZHcmlkKGNvb3JkaW5hdGUpIHtcclxuICAgIHJldHVybiAoXHJcbiAgICAgIGNvb3JkaW5hdGUueCA+PSB0aGlzLndpZHRoIHx8XHJcbiAgICAgIGNvb3JkaW5hdGUueSA+PSB0aGlzLmhlaWdodCB8fFxyXG4gICAgICBjb29yZGluYXRlLnkgPCAwIHx8XHJcbiAgICAgIGNvb3JkaW5hdGUueCA8IDBcclxuICAgICk7XHJcbiAgfVxyXG59XHJcblxyXG5jbGFzcyBTbmFrZSB7XHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHsqfSBnYW1lRmllbGQgZ2FtZSBmaWVsZCBpbmZvXHJcbiAgICogQHBhcmFtIHsqfSBkaXJlY3Rpb24gdXAsIGRvd24sIHJpZ2h0LCBsZWZ0XHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoZ2FtZUZpZWxkLCBkaXJlY3Rpb24pIHtcclxuICAgIHRoaXMuZ2FtZUZpZWxkID0gZ2FtZUZpZWxkO1xyXG4gICAgdGhpcy5kaXJlY3Rpb24gPSBkaXJlY3Rpb247XHJcbiAgICB0aGlzLm5leHREaXJlY3Rpb24gPSBkaXJlY3Rpb247XHJcbiAgICB0aGlzLnN0YXRlID0gW1xyXG4gICAgICBuZXcgQ29vcmRpbmF0ZSg0LCA1KSxcclxuICAgICAgbmV3IENvb3JkaW5hdGUoNSwgNSksXHJcbiAgICAgIG5ldyBDb29yZGluYXRlKDYsIDUpLFxyXG4gICAgXTtcclxuICB9XHJcbiAgaXNTbmFrZUNvb3JkaW5hdGUoY29vcmRpbmF0ZSkge1xyXG4gICAgY29uc3QgZXF1YWxDb29yZGluYXRlcyA9IHRoaXMuc3RhdGUuZmlsdGVyKChpdGVtKSA9PlxyXG4gICAgICBpdGVtLmlzRXF1YWwoY29vcmRpbmF0ZSlcclxuICAgICk7XHJcbiAgICByZXR1cm4gISFlcXVhbENvb3JkaW5hdGVzLmxlbmd0aDtcclxuICB9XHJcbiAgaXNSZXZlcnNlRGlyZWN0aW9uKGRpcmVjdGlvbikge1xyXG4gICAgaWYgKGRpcmVjdGlvbiA9PT0gRElSRUNUSU9OLkRPV04pIHtcclxuICAgICAgcmV0dXJuIHRoaXMuZGlyZWN0aW9uID09PSBESVJFQ1RJT04uVVA7XHJcbiAgICB9XHJcbiAgICBpZiAoZGlyZWN0aW9uID09PSBESVJFQ1RJT04uVVApIHtcclxuICAgICAgcmV0dXJuIHRoaXMuZGlyZWN0aW9uID09PSBESVJFQ1RJT04uRE9XTjtcclxuICAgIH1cclxuICAgIGlmIChkaXJlY3Rpb24gPT09IERJUkVDVElPTi5MRUZUKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmRpcmVjdGlvbiA9PT0gRElSRUNUSU9OLlJJR0hUO1xyXG4gICAgfVxyXG4gICAgaWYgKGRpcmVjdGlvbiA9PT0gRElSRUNUSU9OLlJJR0hUKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmRpcmVjdGlvbiA9PT0gRElSRUNUSU9OLkxFRlQ7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGdldE5leHRDb29yZGluYXRlKCkge1xyXG4gICAgbGV0IG5leHRDb29yZGluYXRlO1xyXG4gICAgY29uc3QgaGVhZENvb3JkaW5hdGUgPSB0aGlzLnN0YXRlW3RoaXMuc3RhdGUubGVuZ3RoIC0gMV07XHJcbiAgICBzd2l0Y2ggKHRoaXMubmV4dERpcmVjdGlvbikge1xyXG4gICAgICBjYXNlIERJUkVDVElPTi5SSUdIVDoge1xyXG4gICAgICAgIG5leHRDb29yZGluYXRlID0gbmV3IENvb3JkaW5hdGUoaGVhZENvb3JkaW5hdGUueCArIDEsIGhlYWRDb29yZGluYXRlLnkpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICAgIGNhc2UgRElSRUNUSU9OLkxFRlQ6IHtcclxuICAgICAgICBuZXh0Q29vcmRpbmF0ZSA9IG5ldyBDb29yZGluYXRlKGhlYWRDb29yZGluYXRlLnggLSAxLCBoZWFkQ29vcmRpbmF0ZS55KTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgICBjYXNlIERJUkVDVElPTi5VUDoge1xyXG4gICAgICAgIG5leHRDb29yZGluYXRlID0gbmV3IENvb3JkaW5hdGUoaGVhZENvb3JkaW5hdGUueCwgaGVhZENvb3JkaW5hdGUueSAtIDEpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICAgIGNhc2UgRElSRUNUSU9OLkRPV046IHtcclxuICAgICAgICBuZXh0Q29vcmRpbmF0ZSA9IG5ldyBDb29yZGluYXRlKGhlYWRDb29yZGluYXRlLngsIGhlYWRDb29yZGluYXRlLnkgKyAxKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgICBkZWZhdWx0OiB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcIldyb25nIGRpcmVjdGlvbiBcIiwgZGlyZWN0aW9uKTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBuZXh0Q29vcmRpbmF0ZTtcclxuICB9XHJcbiAgbW92ZSgpIHtcclxuICAgIGNvbnN0IG5leHRDb29yZGluYXRlID0gdGhpcy5nZXROZXh0Q29vcmRpbmF0ZSh0aGlzLmRpcmVjdGlvbik7XHJcblxyXG4gICAgaWYgKHRoaXMuY2FuR29Db29yZGluYXRlKG5leHRDb29yZGluYXRlKSkge1xyXG4gICAgICB0aGlzLnN0YXRlLnNoaWZ0KCk7XHJcbiAgICAgIHRoaXMuc3RhdGUucHVzaChuZXh0Q29vcmRpbmF0ZSk7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuICBjYW5Hb0RpcmVjdGlvbihkaXJlY3Rpb24pIHtcclxuICAgIHJldHVybiAhdGhpcy5pc1JldmVyc2VEaXJlY3Rpb24oZGlyZWN0aW9uKTtcclxuICB9XHJcbiAgY2FuR29Db29yZGluYXRlKGNvb3JkaW5hdGUpIHtcclxuICAgIGlmICghdGhpcy5pc1NuYWtlQ29vcmRpbmF0ZShjb29yZGluYXRlKSkge1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcbiAgc2V0TmV3RGlyZWN0aW9uKGRpcmVjdGlvbikge1xyXG4gICAgdGhpcy5uZXh0RGlyZWN0aW9uID0gZGlyZWN0aW9uO1xyXG4gIH1cclxuICB1cGRhdGVEaXJlY3Rpb24oKSB7XHJcbiAgICB0aGlzLmRpcmVjdGlvbiA9IHRoaXMubmV4dERpcmVjdGlvbjtcclxuICB9XHJcbiAgYWRkKCkge1xyXG4gICAgY29uc3QgbmV4dENvb3JkaW5hdGUgPSB0aGlzLmdldE5leHRDb29yZGluYXRlKHRoaXMuZGlyZWN0aW9uKTtcclxuXHJcbiAgICBpZiAodGhpcy5jYW5Hb0Nvb3JkaW5hdGUobmV4dENvb3JkaW5hdGUpKSB7XHJcbiAgICAgIHRoaXMuc3RhdGUucHVzaChuZXh0Q29vcmRpbmF0ZSk7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxufVxyXG5cclxuY2xhc3MgQ29vcmRpbmF0ZSB7XHJcbiAgY29uc3RydWN0b3IoeCwgeSkge1xyXG4gICAgdGhpcy54ID0geDtcclxuICAgIHRoaXMueSA9IHk7XHJcbiAgfVxyXG4gIGlzRXF1YWwoY29vcmRpbmF0ZSkge1xyXG4gICAgcmV0dXJuIHRoaXMueCA9PT0gY29vcmRpbmF0ZS54ICYmIHRoaXMueSA9PT0gY29vcmRpbmF0ZS55O1xyXG4gIH1cclxufVxyXG5cclxuY2xhc3MgR2FtZUNvbnRyb2xsZXIge1xyXG4gIGNvbnN0cnVjdG9yKGdyaWRIZWlnaHQsIGdyaWRXaWR0aCkge1xyXG4gICAgdGhpcy5ncmlkRmllbGQgPSBuZXcgR3JpZChncmlkSGVpZ2h0LCBncmlkV2lkdGgpO1xyXG4gICAgdGhpcy5zbmFrZSA9IG5ldyBTbmFrZSh0aGlzLmdyaWRGaWVsZCwgRElSRUNUSU9OLlJJR0hUKTtcclxuICAgIHRoaXMuZm9vZCA9IHRoaXMuZ2V0Rm9vZFBvc2l0aW9uKCk7XHJcbiAgICB0aGlzLmlzR2FtZU92ZXIgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIHNldERpcmVjdGlvbihkaXJlY3Rpb24pIHtcclxuICAgIGlmICh0aGlzLnNuYWtlLmNhbkdvRGlyZWN0aW9uKGRpcmVjdGlvbikpIHtcclxuICAgICAgdGhpcy5zbmFrZS5zZXROZXdEaXJlY3Rpb24oZGlyZWN0aW9uKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGdldEZvb2RQb3NpdGlvbigpIHtcclxuICAgIGxldCBjb29yZGluYXRlO1xyXG4gICAgZG8ge1xyXG4gICAgICBjb25zdCBwb3NpdGlvblggPSBnZW5lcmF0ZUNvb3JkaW5hdGUoZ3JpZFdpZHRoKTtcclxuICAgICAgY29uc3QgcG9zaXRpb25ZID0gZ2VuZXJhdGVDb29yZGluYXRlKGdyaWRIZWlnaHQpO1xyXG4gICAgICBjb29yZGluYXRlID0gbmV3IENvb3JkaW5hdGUocG9zaXRpb25YLCBwb3NpdGlvblkpO1xyXG4gICAgfSB3aGlsZSAodGhpcy5zbmFrZS5pc1NuYWtlQ29vcmRpbmF0ZShjb29yZGluYXRlKSk7XHJcblxyXG4gICAgcmV0dXJuIGNvb3JkaW5hdGU7XHJcbiAgfVxyXG5cclxuICB1cGRhdGVTdGF0ZSgpIHtcclxuICAgIGNvbnN0IG5leHRDb29yZGluYXRlID0gdGhpcy5zbmFrZS5nZXROZXh0Q29vcmRpbmF0ZSgpO1xyXG4gICAgaWYgKFxyXG4gICAgICB0aGlzLnNuYWtlLmlzU25ha2VDb29yZGluYXRlKG5leHRDb29yZGluYXRlKSB8fFxyXG4gICAgICB0aGlzLmdyaWRGaWVsZC5pc091dE9mR3JpZChuZXh0Q29vcmRpbmF0ZSlcclxuICAgICkge1xyXG4gICAgICB0aGlzLmlzR2FtZU92ZXIgPSB0cnVlO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLnNuYWtlLnVwZGF0ZURpcmVjdGlvbigpO1xyXG4gICAgaWYgKHRoaXMuZm9vZC5pc0VxdWFsKG5leHRDb29yZGluYXRlKSkge1xyXG4gICAgICB0aGlzLnNuYWtlLmFkZCgpO1xyXG4gICAgICB0aGlzLmZvb2QgPSB0aGlzLmdldEZvb2RQb3NpdGlvbigpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5zbmFrZS5tb3ZlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBnZW5lcmF0ZUNvb3JkaW5hdGUobWF4VmFsdWUpIHtcclxuICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogbWF4VmFsdWUpO1xyXG59XHJcblxyXG5jbGFzcyBHcmlkUmVuZGVyIHtcclxuICBzdGF0aWMgcmVuZGVyKGdhbWVDb250cm9sbGVyKSB7XHJcbiAgICB0aGlzLnRhYmxlQ3JlYXRlKGdhbWVDb250cm9sbGVyKTtcclxuICAgIHRoaXMucGFpbnRHcmlkKGdhbWVDb250cm9sbGVyKTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyB0YWJsZUNyZWF0ZShnYW1lQ29udHJvbGxlcikge1xyXG4gICAgY29uc3Qgcm9vdE5vZGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJvb3RcIik7XHJcbiAgICBjb25zdCB0YWJsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0YWJsZVwiKTtcclxuICAgIHRhYmxlLnNldEF0dHJpYnV0ZShcImlkXCIsIGdyaWRJZCk7XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBnYW1lQ29udHJvbGxlci5ncmlkRmllbGQuaGVpZ2h0OyBpKyspIHtcclxuICAgICAgY29uc3QgdHIgPSB0YWJsZS5pbnNlcnRSb3coKTtcclxuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBnYW1lQ29udHJvbGxlci5ncmlkRmllbGQud2lkdGg7IGorKykge1xyXG4gICAgICAgIHRyLmluc2VydENlbGwoKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcm9vdE5vZGUuaW5uZXJIVE1MID0gXCJcIjtcclxuICAgIHJvb3ROb2RlLmFwcGVuZENoaWxkKHRhYmxlKTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBwYWludEdyaWQoZ2FtZUNvbnRyb2xsZXIpIHtcclxuICAgIGNvbnN0IHRhYmxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZ3JpZElkKTtcclxuICAgIHRoaXMucGFpbnRGb29kKGdhbWVDb250cm9sbGVyLCB0YWJsZSk7XHJcbiAgICB0aGlzLnBhaW50U25ha2UoZ2FtZUNvbnRyb2xsZXIsIHRhYmxlKTtcclxuICAgIGlmIChnYW1lQ29udHJvbGxlci5pc0dhbWVPdmVyKSB7XHJcbiAgICAgIHRoaXMucHJpbnRHYW1lT3ZlcigpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc3RhdGljIHByaW50R2FtZU92ZXIoKSB7XHJcbiAgICBjb25zdCByb290Tm9kZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicm9vdFwiKTtcclxuICAgIGNvbnN0IGdhbWVPdmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XHJcbiAgICBnYW1lT3Zlci50ZXh0Q29udGVudCA9IFwiR2FtZSBvdmVyXCI7XHJcbiAgICBnYW1lT3Zlci5jbGFzc0xpc3QuYWRkKFwiZ2FtZU92ZXJcIik7XHJcbiAgICByb290Tm9kZS5hcHBlbmQoZ2FtZU92ZXIpO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIHBhaW50Rm9vZChnYW1lQ29udHJvbGxlciwgdGFibGUpIHtcclxuICAgIGNvbnN0IGZvb2RUZCA9XHJcbiAgICAgIHRhYmxlLnJvd3NbZ2FtZUNvbnRyb2xsZXIuZm9vZC55XS5jZWxsc1tnYW1lQ29udHJvbGxlci5mb29kLnhdO1xyXG4gICAgZm9vZFRkLmNsYXNzTGlzdC5hZGQoXCJmb29kXCIpO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIHBhaW50U25ha2UoZ2FtZUNvbnRyb2xsZXIsIHRhYmxlKSB7XHJcbiAgICBnYW1lQ29udHJvbGxlci5zbmFrZS5zdGF0ZS5mb3JFYWNoKChpdGVtLCBpbmRleCwgYXJyYXkpID0+IHtcclxuICAgICAgY29uc3QgaXNTbmFrZUhlYWQgPSBpbmRleCA9PT0gYXJyYXkubGVuZ3RoIC0gMTtcclxuICAgICAgY29uc3QgdGQgPSB0YWJsZS5yb3dzW2l0ZW0ueV0uY2VsbHNbaXRlbS54XTtcclxuICAgICAgaWYgKGlzU25ha2VIZWFkKSB7XHJcbiAgICAgICAgdGQuY2xhc3NMaXN0LmFkZChcInNuYWtlSGVhZFwiKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0ZC5jbGFzc0xpc3QuYWRkKFwic25ha2VCb2R5XCIpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzdGFydEdhbWUoKSB7XHJcbiAgY29uc3QgZ2FtZSA9IG5ldyBHYW1lQ29udHJvbGxlcihncmlkSGVpZ2h0LCBncmlkV2lkdGgpO1xyXG4gIEdyaWRSZW5kZXIucmVuZGVyKGdhbWUpO1xyXG5cclxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCAoZXZlbnQpID0+IHtcclxuICAgIGxldCBkaXJlY3Rpb247XHJcbiAgICBzd2l0Y2ggKGV2ZW50LmtleSkge1xyXG4gICAgICBjYXNlIFwiQXJyb3dVcFwiOiB7XHJcbiAgICAgICAgZGlyZWN0aW9uID0gRElSRUNUSU9OLlVQO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICAgIGNhc2UgXCJBcnJvd0Rvd25cIjoge1xyXG4gICAgICAgIGRpcmVjdGlvbiA9IERJUkVDVElPTi5ET1dOO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICAgIGNhc2UgXCJBcnJvd0xlZnRcIjoge1xyXG4gICAgICAgIGRpcmVjdGlvbiA9IERJUkVDVElPTi5MRUZUO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICAgIGNhc2UgXCJBcnJvd1JpZ2h0XCI6IHtcclxuICAgICAgICBkaXJlY3Rpb24gPSBESVJFQ1RJT04uUklHSFQ7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGdhbWUuc2V0RGlyZWN0aW9uKGRpcmVjdGlvbik7XHJcbiAgfSk7XHJcblxyXG4gIGNvbnN0IGludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgZ2FtZS51cGRhdGVTdGF0ZSgpO1xyXG4gICAgR3JpZFJlbmRlci5yZW5kZXIoZ2FtZSk7XHJcbiAgICBpZiAoZ2FtZS5pc0dhbWVPdmVyKSB7XHJcbiAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKGludGVydmFsKTtcclxuICAgIH1cclxuICB9LCA1MDApO1xyXG59XHJcbiIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuaW1wb3J0IFZET00gZnJvbSBcIi4vdmRvbVwiO1xyXG5pbXBvcnQgTWVudSBmcm9tIFwiLi9tZW51XCI7XHJcbmltcG9ydCB7IHN0YXJ0R2FtZSB9IGZyb20gXCIuL2dhbWVcIjtcclxuXHJcbmNvbnN0IEFQUFNUQVRFID0gT2JqZWN0LmZyZWV6ZSh7XHJcbiAgTUVOVTogU3ltYm9sKFwiTUVOVVwiKSxcclxuICBHQU1FOiBTeW1ib2woXCJHQU1FXCIpLFxyXG59KTtcclxuXHJcbmNsYXNzIFNuYWtlR2FtZSB7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLnN0YXRlID0gQVBQU1RBVEUuTUVOVTtcclxuICAgIHRoaXMuYXBwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyb290XCIpXHJcbiAgICB0aGlzW0FQUFNUQVRFLk1FTlVdID0gbmV3IE1lbnUodGhpcy5hcHApO1xyXG4gICAgY29uc3QgbWVudVZpZXcgPSB0aGlzW3RoaXMuc3RhdGVdLmNyZWF0ZVZBcHAoKTtcclxuICAgIHRoaXMuYXBwID0gVkRPTS5wYXRjaChtZW51VmlldywgdGhpcy5hcHApO1xyXG4gIH1cclxuXHJcbiAgb25TdGF0ZUNoYW5nZWQoKSB7XHJcbiAgICB0aGlzW3RoaXMuc3RhdGVdLmNyZWF0ZVZBcHAoKTtcclxuICAgIFZET00ucGF0Y2goY3JlYXRlVkFwcCh0aGlzLnN0b3JlKSwgYXBwKTtcclxuICB9XHJcblxyXG4gIHNldFN0YXRlKG5leHRTdGF0ZSkge1xyXG4gICAgdGhpcy5zdGF0ZSA9IG5leHRTdGF0ZTtcclxuICAgIHRoaXMub25TdGF0ZUNoYW5nZWQoKTtcclxuICB9XHJcbn1cclxuXHJcbi8vIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvbmtleWRvd24nLCAoZXZlbnQpID0+IHtcclxuLy8gICBjb25zb2xlLmxvZygnb25rZXlkb3duIGdsb2JhbCcsIGV2ZW50KVxyXG4vLyB9KVxyXG5cclxuY29uc3QgZ2FtZSA9IG5ldyBTbmFrZUdhbWUoKVxyXG4iXSwibmFtZXMiOlsiVkRPTSIsInN0YXRpYyIsInBhcmVudCIsInZDaGlsZHJlbiIsIm5leHRWQ2hpbGRyZW4iLCJjaGlsZE5vZGVzIiwiZm9yRWFjaCIsImNoaWxkTm9kZSIsImkiLCJ0aGlzIiwicGF0Y2hOb2RlIiwic2xpY2UiLCJsZW5ndGgiLCJ2Q2hpbGQiLCJhcHBlbmRDaGlsZCIsImNyZWF0ZURPTU5vZGUiLCJub2RlIiwia2V5IiwidmFsdWUiLCJuZXh0VmFsdWUiLCJzdGFydHNXaXRoIiwiZXZlbnROYW1lIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJzZXRBdHRyaWJ1dGUiLCJyZW1vdmVBdHRyaWJ1dGUiLCJwcm9wcyIsIm5leHRQcm9wcyIsIm1lcmdlZFByb3BzIiwiT2JqZWN0Iiwia2V5cyIsInBhdGNoUHJvcCIsInZOb2RlIiwibmV4dFZOb2RlIiwidW5kZWZpbmVkIiwibmV4dE5vZGUiLCJyZXBsYWNlV2l0aCIsInRhZ05hbWUiLCJwYXRjaFByb3BzIiwicGF0Y2hDaGlsZHJlbiIsImNoaWxkcmVuIiwicmVtb3ZlIiwiZG9jdW1lbnQiLCJjcmVhdGVUZXh0Tm9kZSIsImNyZWF0ZUVsZW1lbnQiLCJjaGlsZCIsInRhcmdldCIsInYiLCJub2RlVHlwZSIsIm5vZGVWYWx1ZSIsIm5vZGVOYW1lIiwidG9Mb3dlckNhc2UiLCJtYXAiLCJjYWxsIiwiY3JlYXRlVk5vZGUiLCJldmVudCIsInR5cGUiLCJNZW51U3RhdGUiLCJjb25zdHJ1Y3RvciIsImFwcCIsInN0YXRlIiwic2VsZWN0ZWRSb3ciLCJyb3dzIiwib25TdGF0ZUNoYW5nZWQiLCJwYXRjaCIsImNyZWF0ZVZBcHAiLCJzdG9yZSIsImh0bWxNZW51Um93cyIsIml0ZW0iLCJpbmRleCIsImNsYXNzTmFtZSIsImNsYXNzIiwidGFiaW5kZXgiLCJvbmNsaWNrIiwic2V0U3RhdGUiLCJvbmtleWRvd24iLCJjb25zb2xlIiwibG9nIiwiYWN0aW9uIiwiZnJlZXplIiwiUklHSFQiLCJTeW1ib2wiLCJMRUZUIiwiVVAiLCJET1dOIiwiQVBQU1RBVEUiLCJNRU5VIiwiR0FNRSIsImdldEVsZW1lbnRCeUlkIiwibWVudVZpZXciLCJuZXh0U3RhdGUiXSwic291cmNlUm9vdCI6IiJ9