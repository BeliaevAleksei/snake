(()=>{"use strict";class t{static patchChildren(t,e,s){t.childNodes.forEach(((t,i)=>{this.patchNode(t,e[i],s[i])})),s.slice(e.length).forEach((e=>{t.appendChild(this.createDOMNode(e))}))}static patchProp(t,e,s,i){if(null!=i&&!1!==i){if(e.startsWith("on")){const o=e.slice(2);return t[o]=i,void(i?s||t.addEventListener(o,this.#t):t.removeEventListener(o,this.#t))}t.setAttribute(e,i)}else t.removeAttribute(e)}static patchProps(t,e,s){const i={...e,...s};Object.keys(i).forEach((i=>{e[i]!==s[i]&&this.patchProp(t,i,e[i],s[i])}))}static patchNode(t,e,s){if(void 0!==s){if("string"==typeof e||"string"==typeof s){if(e!==s){const e=this.createDOMNode(s);return t.replaceWith(e),e}return t}if(e.tagName!==s.tagName){const e=this.createDOMNode(s);return t.replaceWith(e),e}return this.patchProps(t,e.props,s.props),this.patchChildren(t,e.children,s.children),t}t.remove()}static createDOMNode(t){if("string"==typeof t)return document.createTextNode(t);const{tagName:e,props:s,children:i}=t,o=document.createElement(e);return this.patchProps(o,{},s),i.forEach((t=>{o.appendChild(this.createDOMNode(t))})),o}static createVNode(t,e={},s=[]){return{tagName:t,props:e,children:s}}static mount(t,e){return e.replaceWith(t),t}static createVButton(t,e={}){return this.createVNode("button",e,[t])}static patch(t,e){const s=e.v||this.#e(e);return(e=this.patchNode(e,s,t)).v=t,e}static#e(t){if(3===t.nodeType)return t.nodeValue;const e=t.nodeName.toLowerCase(),s=[].map.call(t.childNodes,this.#e);return this.createVNode(e,{},s)}static#t(t){return this[t.type](t)}}const e=Object.freeze({MENU:Symbol("MENU"),GAME:Symbol("GAME")});class s{constructor(t,s){this.app=t,this.state={rows:["Start","Options"]},this.startGame=()=>s.onStateChanged(e.GAME)}onStateChanged(){t.patch(this.createVApp(this.store),this.app)}trigerGlobalEvent(t){}createVApp(){const e=[t.createVButton("Start",{class:"menu__item",onclick:()=>this.startGame()}),t.createVButton("Options",{class:"menu__item",onclick:()=>{console.log("Options click")}})];return t.createVNode("div",{class:"menu",onkeydown:t=>{console.log("KEYDOWN",t)}},e)}setState(t,e){"changeSelectedRow"===t&&(this.state.selectedRow=e,"ArrowUp"===e&&this.state.selectedRow-1<0&&(this.state.selectedRow=this.state.rows.length-1),"ArrowDown"===e&&this.state.selectedRow+1>this.state.rows.length-1&&(this.state.selectedRow=0),this.onStateChanged())}}const i=Object.freeze({RIGHT:Symbol("RIGHT"),LEFT:Symbol("LEFT"),UP:Symbol("UP"),DOWN:Symbol("DOWN")});class o{constructor(t,e){this.width=t,this.height=e}isOutOfGrid(t){return t.x>=this.width||t.y>=this.height||t.y<0||t.x<0}}class r{constructor(t,e){this.gameField=t,this.direction=e,this.nextDirection=e,this.state=[new a(4,5),new a(5,5),new a(6,5)]}isSnakeCoordinate(t){return!!this.state.filter((e=>e.isEqual(t))).length}isReverseDirection(t){return t===i.DOWN?this.direction===i.UP:t===i.UP?this.direction===i.DOWN:t===i.LEFT?this.direction===i.RIGHT:t===i.RIGHT?this.direction===i.LEFT:void 0}getNextCoordinate(){let t;const e=this.state[this.state.length-1];switch(this.nextDirection){case i.RIGHT:t=new a(e.x+1,e.y);break;case i.LEFT:t=new a(e.x-1,e.y);break;case i.UP:t=new a(e.x,e.y-1);break;case i.DOWN:t=new a(e.x,e.y+1);break;default:return console.error("Wrong direction ",direction),!1}return t}move(){const t=this.getNextCoordinate(this.direction);return!!this.canGoCoordinate(t)&&(this.state.shift(),this.state.push(t),!0)}canGoDirection(t){return!this.isReverseDirection(t)}canGoCoordinate(t){return!this.isSnakeCoordinate(t)}setNewDirection(t){this.nextDirection=t}updateDirection(){this.direction=this.nextDirection}add(){const t=this.getNextCoordinate(this.direction);return!!this.canGoCoordinate(t)&&(this.state.push(t),!0)}}class a{constructor(t,e){this.x=t,this.y=e}isEqual(t){return this.x===t.x&&this.y===t.y}}class n{constructor(t,e,s,a){this.gridField=new o(t,e),this.snake=new r(this.gridField,i.RIGHT),this.food=this.getFoodPosition(),this.isGameOver=!1,this.app=s,this.interval}onStateChanged(){t.patch(this.createVApp(),this.app)}startGame(t){this.app=t,this.interval=setInterval((()=>{this.updateState(),this.isGameOver&&window.clearInterval(this.interval)}),500)}setDirection(t){this.snake.canGoDirection(t)&&this.snake.setNewDirection(t)}getFoodPosition(){let t;do{const e=h(11),s=h(11);t=new a(e,s)}while(this.snake.isSnakeCoordinate(t));return t}updateState(){const t=this.snake.getNextCoordinate();this.snake.isSnakeCoordinate(t)||this.gridField.isOutOfGrid(t)?this.isGameOver=!0:(this.snake.updateDirection(),this.food.isEqual(t)?(this.snake.add(),this.food=this.getFoodPosition()):this.snake.move(),console.log("game",this.app),this.onStateChanged())}createVApp(){return this.isGameOver?this.getGameOverView():this.getGameView()}getGameView(){const e=[];for(let s=0;s<this.gridField.height;s++){const i=[];for(let e=0;e<this.gridField.width;e++){const o={};s===this.food.y&&e===this.food.x&&(o.class="food"),i.push(t.createVNode("td",o))}e.push(t.createVNode("tr",{},i))}return this.snake.state.forEach(((t,s,i)=>{const o=s===i.length-1;e[t.y].children[t.x].props.class=o?"snakeHead":"snakeBody"})),t.createVNode("table",{id:"gameGrid"},e)}getGameOverView(){return t.createVNode("p",{class:"gameOver"},"Game over")}}function h(t){return Math.floor(Math.random()*t)}const c=new class{constructor(){this.state=e.MENU,this.app=document.getElementById("root"),this.views={[e.MENU]:new s(this.app,this),[e.GAME]:new n(11,11,this.app,this)},this.onStateChanged(e.MENU)}onStateChanged(t){this.state=t,this.renderViewByState()}renderViewByState(){const s=this.views[this.state].createVApp();this.app=t.patch(s,this.app),this.state===e.GAME&&this.views[e.GAME].startGame(this.app),console.log("main",this.app)}trigerGlobalEvent(t){this[this.state].trigerGlobalEvent(t)}};window.addEventListener("onkeydown",(t=>{console.log("onkeydown global",t),c.trigerGlobalEvent(t)}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TyxJQTlCYixNQUNFdEYsY0FDRXZELEtBQUswRCxNQUFRVCxFQUFTRSxLQUN0Qm5ELEtBQUt3RCxJQUFNdkIsU0FBUzZHLGVBQWUsUUFDbkM5SSxLQUFLK0ksTUFBUSxDQUNYLENBQUM5RixFQUFTRSxNQUFPLElBQUksRUFBS25ELEtBQUt3RCxJQUFLeEQsTUFDcEMsQ0FBQ2lELEVBQVNJLE1BQU8sSUFBSSxFQUFLLEdBQUksR0FBSXJELEtBQUt3RCxJQUFLeEQsT0FFOUNBLEtBQUs2RCxlQUFlWixFQUFTRSxLQUMvQixDQUVBVSxlQUFlbUYsR0FDYmhKLEtBQUswRCxNQUFRc0YsRUFDYmhKLEtBQUtpSixtQkFDUCxDQUVBQSxvQkFDRSxNQUFNQyxFQUFPbEosS0FBSytJLE1BQU0vSSxLQUFLMEQsT0FBT0ssYUFDcEMvRCxLQUFLd0QsSUFBTWpFLEVBQUt1RSxNQUFNb0YsRUFBTWxKLEtBQUt3RCxLQUM3QnhELEtBQUswRCxRQUFVVCxFQUFTSSxNQUMxQnJELEtBQUsrSSxNQUFNOUYsRUFBU0ksTUFBTU8sVUFBVTVELEtBQUt3RCxLQUUzQ2MsUUFBUUMsSUFBSSxPQUFRdkUsS0FBS3dELElBQzNCLENBRUFTLGtCQUFrQmxCLEdBQ2hCL0MsS0FBS0EsS0FBSzBELE9BQU9PLGtCQUFrQmxCLEVBQ3JDLEdBSUYwRSxPQUFPNUcsaUJBQWlCLGFBQWNrQyxJQUNwQ3VCLFFBQVFDLElBQUksbUJBQW9CeEIsR0FDaEM4RixFQUFLNUUsa0JBQWtCbEIsRUFBTSxHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc25ha2UvLi9zcmMvdmRvbS5qcyIsIndlYnBhY2s6Ly9zbmFrZS8uL3NyYy9nYW1lU3RhdGUuanMiLCJ3ZWJwYWNrOi8vc25ha2UvLi9zcmMvbWVudS5qcyIsIndlYnBhY2s6Ly9zbmFrZS8uL3NyYy9nYW1lLmpzIiwid2VicGFjazovL3NuYWtlLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IFRFWFRfTk9ERV9UWVBFID0gMztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFZET00ge1xyXG4gIHN0YXRpYyBwYXRjaENoaWxkcmVuKHBhcmVudCwgdkNoaWxkcmVuLCBuZXh0VkNoaWxkcmVuKSB7XHJcbiAgICBwYXJlbnQuY2hpbGROb2Rlcy5mb3JFYWNoKChjaGlsZE5vZGUsIGkpID0+IHtcclxuICAgICAgdGhpcy5wYXRjaE5vZGUoY2hpbGROb2RlLCB2Q2hpbGRyZW5baV0sIG5leHRWQ2hpbGRyZW5baV0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgbmV4dFZDaGlsZHJlbi5zbGljZSh2Q2hpbGRyZW4ubGVuZ3RoKS5mb3JFYWNoKCh2Q2hpbGQpID0+IHtcclxuICAgICAgcGFyZW50LmFwcGVuZENoaWxkKHRoaXMuY3JlYXRlRE9NTm9kZSh2Q2hpbGQpKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIHBhdGNoUHJvcChub2RlLCBrZXksIHZhbHVlLCBuZXh0VmFsdWUpIHtcclxuICAgIC8vINCV0YHQu9C4INC90L7QstC+0LUg0LfQvdCw0YfQtdC90LjQtSDQvdC1INC30LDQtNCw0L3Qviwg0YLQviDRg9C00LDQu9GP0LXQvCDQsNGC0YDQuNCx0YPRglxyXG4gICAgaWYgKG5leHRWYWx1ZSA9PSBudWxsIHx8IG5leHRWYWx1ZSA9PT0gZmFsc2UpIHtcclxuICAgICAgbm9kZS5yZW1vdmVBdHRyaWJ1dGUoa2V5KTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChrZXkuc3RhcnRzV2l0aChcIm9uXCIpKSB7XHJcbiAgICAgIGNvbnN0IGV2ZW50TmFtZSA9IGtleS5zbGljZSgyKTtcclxuXHJcbiAgICAgIG5vZGVbZXZlbnROYW1lXSA9IG5leHRWYWx1ZTtcclxuICAgICAgLy8gY29uc29sZS5sb2cobm9kZSwga2V5LCB2YWx1ZSwgbmV4dFZhbHVlKTtcclxuICAgICAgaWYgKCFuZXh0VmFsdWUpIHtcclxuICAgICAgICBub2RlLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCB0aGlzLiNsaXN0ZW5lcik7XHJcbiAgICAgIH0gZWxzZSBpZiAoIXZhbHVlKSB7XHJcbiAgICAgICAgbm9kZS5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgdGhpcy4jbGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIC8vINCj0YHRgtCw0L3QsNCy0LvQuNCy0LDQtdC8INC90L7QstC+0LUg0LfQvdCw0YfQtdC90LjQtSDQsNGC0YDQuNCx0YPRgtCwXHJcbiAgICBub2RlLnNldEF0dHJpYnV0ZShrZXksIG5leHRWYWx1ZSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgcGF0Y2hQcm9wcyhub2RlLCBwcm9wcywgbmV4dFByb3BzKSB7XHJcbiAgICAvLyDQntCx0YrQtdC60YIg0YEg0L7QsdGJ0LjQvNC4INGB0LLQvtC50YHRgtCy0LDQvNC4XHJcbiAgICBjb25zdCBtZXJnZWRQcm9wcyA9IHsgLi4ucHJvcHMsIC4uLm5leHRQcm9wcyB9O1xyXG5cclxuICAgIE9iamVjdC5rZXlzKG1lcmdlZFByb3BzKS5mb3JFYWNoKChrZXkpID0+IHtcclxuICAgICAgLy8g0JXRgdC70Lgg0LfQvdCw0YfQtdC90LjQtSDQvdC1INC40LfQvNC10L3QuNC70L7RgdGMLCDRgtC+INC90LjRh9C10LPQviDQvdC1INC+0LHQvdC+0LLQu9GP0LXQvFxyXG4gICAgICBpZiAocHJvcHNba2V5XSAhPT0gbmV4dFByb3BzW2tleV0pIHtcclxuICAgICAgICB0aGlzLnBhdGNoUHJvcChub2RlLCBrZXksIHByb3BzW2tleV0sIG5leHRQcm9wc1trZXldKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgcGF0Y2hOb2RlKG5vZGUsIHZOb2RlLCBuZXh0Vk5vZGUpIHtcclxuICAgIC8vINCj0LTQsNC70Y/QtdC8INC90L7QtNGDLCDQtdGB0LvQuCDQt9C90LDRh9C10L3QuNC1IG5leHRWTm9kZSDQvdC1INC30LDQtNCw0L3QvlxyXG4gICAgaWYgKG5leHRWTm9kZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIG5vZGUucmVtb3ZlKCk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodHlwZW9mIHZOb2RlID09PSBcInN0cmluZ1wiIHx8IHR5cGVvZiBuZXh0Vk5vZGUgPT09IFwic3RyaW5nXCIpIHtcclxuICAgICAgLy8g0JfQsNC80LXQvdGP0LXQvCDQvdC+0LTRgyDQvdCwINC90L7QstGD0Y4sINC10YHQu9C4INC60LDQuiDQvNC40L3QuNC80YPQvCDQvtC00L3QviDQuNC3INC30L3QsNGH0LXQvdC40Lkg0YDQsNCy0L3QviDRgdGC0YDQvtC60LVcclxuICAgICAgLy8g0Lgg0Y3RgtC4INC30L3QsNGH0LXQvdC40Y8g0L3QtSDRgNCw0LLQvdGLINC00YDRg9CzINC00YDRg9Cz0YNcclxuICAgICAgaWYgKHZOb2RlICE9PSBuZXh0Vk5vZGUpIHtcclxuICAgICAgICBjb25zdCBuZXh0Tm9kZSA9IHRoaXMuY3JlYXRlRE9NTm9kZShuZXh0Vk5vZGUpO1xyXG4gICAgICAgIG5vZGUucmVwbGFjZVdpdGgobmV4dE5vZGUpO1xyXG4gICAgICAgIHJldHVybiBuZXh0Tm9kZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8g0JXRgdC70Lgg0LTQstCwINC30L3QsNGH0LXQvdC40Y8gLSDRjdGC0L4g0YHRgtGA0L7QutC4INC4INC+0L3QuCDRgNCw0LLQvdGLLFxyXG4gICAgICAvLyDQv9GA0L7RgdGC0L4g0LLQvtC30LLRgNCw0YnQsNC10Lwg0YLQtdC60YPRidGD0Y4g0L3QvtC00YNcclxuICAgICAgcmV0dXJuIG5vZGU7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g0JfQsNC80LXQvdGP0LXQvCDQvdC+0LTRgyDQvdCwINC90L7QstGD0Y4sINC10YHQu9C4INGC0LXQs9C4INC90LUg0YDQsNCy0L3Ri1xyXG4gICAgaWYgKHZOb2RlLnRhZ05hbWUgIT09IG5leHRWTm9kZS50YWdOYW1lKSB7XHJcbiAgICAgIGNvbnN0IG5leHROb2RlID0gdGhpcy5jcmVhdGVET01Ob2RlKG5leHRWTm9kZSk7XHJcbiAgICAgIG5vZGUucmVwbGFjZVdpdGgobmV4dE5vZGUpO1xyXG4gICAgICByZXR1cm4gbmV4dE5vZGU7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g0J/QsNGC0YfQuNC8INGB0LLQvtC50YHRgtCy0LBcclxuICAgIHRoaXMucGF0Y2hQcm9wcyhub2RlLCB2Tm9kZS5wcm9wcywgbmV4dFZOb2RlLnByb3BzKTtcclxuXHJcbiAgICAvLyDQn9Cw0YLRh9C40Lwg0LTQtdGC0LXQuVxyXG4gICAgdGhpcy5wYXRjaENoaWxkcmVuKG5vZGUsIHZOb2RlLmNoaWxkcmVuLCBuZXh0Vk5vZGUuY2hpbGRyZW4pO1xyXG5cclxuICAgIC8vINCS0L7Qt9Cy0YDQsNGJ0LDQtdC8INC+0LHQvdC+0LLQu9C10L3QvdGL0LkgRE9NLdGN0LvQtdC80LXQvdGCXHJcbiAgICByZXR1cm4gbm9kZTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBjcmVhdGVET01Ob2RlKHZOb2RlKSB7XHJcbiAgICBpZiAodHlwZW9mIHZOb2RlID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgIHJldHVybiBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh2Tm9kZSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyB0YWdOYW1lLCBwcm9wcywgY2hpbGRyZW4gfSA9IHZOb2RlO1xyXG5cclxuICAgIGNvbnN0IG5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZ05hbWUpO1xyXG4gICAgdGhpcy5wYXRjaFByb3BzKG5vZGUsIHt9LCBwcm9wcyk7XHJcblxyXG4gICAgY2hpbGRyZW4uZm9yRWFjaCgoY2hpbGQpID0+IHtcclxuICAgICAgbm9kZS5hcHBlbmRDaGlsZCh0aGlzLmNyZWF0ZURPTU5vZGUoY2hpbGQpKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBub2RlO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGNyZWF0ZVZOb2RlKHRhZ05hbWUsIHByb3BzID0ge30sIGNoaWxkcmVuID0gW10pIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHRhZ05hbWUsXHJcbiAgICAgIHByb3BzLFxyXG4gICAgICBjaGlsZHJlbixcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgbW91bnQobm9kZSwgdGFyZ2V0KSB7XHJcbiAgICB0YXJnZXQucmVwbGFjZVdpdGgobm9kZSk7XHJcbiAgICByZXR1cm4gbm9kZTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBjcmVhdGVWQnV0dG9uKHRleHQsIHByb3BzID0ge30pIHtcclxuICAgIHJldHVybiB0aGlzLmNyZWF0ZVZOb2RlKFwiYnV0dG9uXCIsIHByb3BzLCBbdGV4dF0pO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIHBhdGNoKG5leHRWTm9kZSwgbm9kZSkge1xyXG4gICAgLy8g0J/QvtC70YPRh9Cw0LXQvCDRgtC10LrRg9GJ0LXQtSDQstC40YDRgtGD0LDQu9GM0L3QvtC1INC00LXRgNC10LLQviDQuNC3IERPTS3QvdC+0LTRi1xyXG4gICAgY29uc3Qgdk5vZGUgPSBub2RlLnYgfHwgdGhpcy4jcmVjeWNsZU5vZGUobm9kZSk7XHJcbiAgICAvLyDQn9Cw0YLRh9C40LwgRE9NLdC90L7QtNGDXHJcbiAgICBub2RlID0gdGhpcy5wYXRjaE5vZGUobm9kZSwgdk5vZGUsIG5leHRWTm9kZSk7XHJcbiAgICAvLyDQodC+0YXRgNCw0L3Rj9C10Lwg0LLQuNGA0YLRg9Cw0LvRjNC90L7QtSDQtNC10YDQtdCy0L4g0LIgRE9NLdC90L7QtNGDXHJcbiAgICBub2RlLnYgPSBuZXh0Vk5vZGU7XHJcblxyXG4gICAgcmV0dXJuIG5vZGU7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgI3JlY3ljbGVOb2RlKG5vZGUpIHtcclxuICAgIC8vINCV0YHQu9C4INGC0LXQutGB0YLQvtCy0LDRjyDQvdC+0LTQsCAtINGC0L4g0LLQvtC30LLRgNCw0YnQsNC10Lwg0YLQtdC60YHRglxyXG4gICAgaWYgKG5vZGUubm9kZVR5cGUgPT09IFRFWFRfTk9ERV9UWVBFKSB7XHJcbiAgICAgIHJldHVybiBub2RlLm5vZGVWYWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyAg0J/QvtC70YPRh9Cw0LXQvCDQuNC80Y8g0YLQtdCz0LBcclxuICAgIGNvbnN0IHRhZ05hbWUgPSBub2RlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7XHJcblxyXG4gICAgLy8g0KDQtdC60YPRgNGB0LjQstC90L4g0L7QsdGA0LDQsdCw0YLRi9Cy0LDQtdC8INC00L7Rh9C10YDQvdC40LUg0L3QvtC00YtcclxuICAgIGNvbnN0IGNoaWxkcmVuID0gW10ubWFwLmNhbGwobm9kZS5jaGlsZE5vZGVzLCB0aGlzLiNyZWN5Y2xlTm9kZSk7XHJcblxyXG4gICAgLy8g0KHQvtC30LTQsNC10Lwg0LLQuNGA0YLRg9Cw0LvRjNC90YPRjiDQvdC+0LTRg1xyXG4gICAgcmV0dXJuIHRoaXMuY3JlYXRlVk5vZGUodGFnTmFtZSwge30sIGNoaWxkcmVuKTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyAjbGlzdGVuZXIoZXZlbnQpIHtcclxuICAgIHJldHVybiB0aGlzW2V2ZW50LnR5cGVdKGV2ZW50KTtcclxuICB9XHJcbn1cclxuIiwiZXhwb3J0IGNvbnN0IEFQUFNUQVRFID0gT2JqZWN0LmZyZWV6ZSh7XHJcbiAgTUVOVTogU3ltYm9sKFwiTUVOVVwiKSxcclxuICBHQU1FOiBTeW1ib2woXCJHQU1FXCIpLFxyXG59KTtcclxuIiwiaW1wb3J0IFZET00gZnJvbSBcIi4vdmRvbVwiO1xyXG5pbXBvcnQgeyBBUFBTVEFURSB9IGZyb20gXCIuL2dhbWVTdGF0ZVwiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTWVudVN0YXRlIHtcclxuICBjb25zdHJ1Y3RvcihhcHAsIHNuYWtlR2FtZSkge1xyXG4gICAgdGhpcy5hcHAgPSBhcHA7XHJcbiAgICB0aGlzLnN0YXRlID0ge1xyXG4gICAgICByb3dzOiBbXCJTdGFydFwiLCBcIk9wdGlvbnNcIl0sXHJcbiAgICB9O1xyXG4gICAgdGhpcy5zdGFydEdhbWUgPSAoKSA9PiBzbmFrZUdhbWUub25TdGF0ZUNoYW5nZWQoQVBQU1RBVEUuR0FNRSk7XHJcbiAgfVxyXG5cclxuICBvblN0YXRlQ2hhbmdlZCgpIHtcclxuICAgIFZET00ucGF0Y2godGhpcy5jcmVhdGVWQXBwKHRoaXMuc3RvcmUpLCB0aGlzLmFwcCk7XHJcbiAgfVxyXG5cclxuICB0cmlnZXJHbG9iYWxFdmVudChldmVudCkge1xyXG4gICAgXHJcbiAgfVxyXG5cclxuICBjcmVhdGVWQXBwKCkge1xyXG4gICAgY29uc3QgaHRtbE1lbnVSb3dzID0gW1xyXG4gICAgICBWRE9NLmNyZWF0ZVZCdXR0b24oXCJTdGFydFwiLCB7XHJcbiAgICAgICAgY2xhc3M6IFwibWVudV9faXRlbVwiLFxyXG4gICAgICAgIG9uY2xpY2s6ICgpID0+IHRoaXMuc3RhcnRHYW1lKCksXHJcbiAgICAgIH0pLFxyXG4gICAgICBWRE9NLmNyZWF0ZVZCdXR0b24oXCJPcHRpb25zXCIsIHtcclxuICAgICAgICBjbGFzczogXCJtZW51X19pdGVtXCIsXHJcbiAgICAgICAgb25jbGljazogKCkgPT4ge1xyXG4gICAgICAgICAgY29uc29sZS5sb2coXCJPcHRpb25zIGNsaWNrXCIpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgIH0pLFxyXG4gICAgXTtcclxuICAgIHJldHVybiBWRE9NLmNyZWF0ZVZOb2RlKFxyXG4gICAgICBcImRpdlwiLFxyXG4gICAgICB7XHJcbiAgICAgICAgY2xhc3M6IFwibWVudVwiLFxyXG4gICAgICAgIG9ua2V5ZG93bjogKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIktFWURPV05cIiwgZXZlbnQpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgIH0sXHJcbiAgICAgIGh0bWxNZW51Um93c1xyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHNldFN0YXRlKGFjdGlvbiwgdmFsdWUpIHtcclxuICAgIGlmIChhY3Rpb24gPT09IFwiY2hhbmdlU2VsZWN0ZWRSb3dcIikge1xyXG4gICAgICB0aGlzLnN0YXRlLnNlbGVjdGVkUm93ID0gdmFsdWU7XHJcbiAgICAgIGlmICh2YWx1ZSA9PT0gXCJBcnJvd1VwXCIpIHtcclxuICAgICAgICBjb25zdCBuZXdTdGF0ZSA9IHRoaXMuc3RhdGUuc2VsZWN0ZWRSb3cgLSAxO1xyXG4gICAgICAgIGlmIChuZXdTdGF0ZSA8IDApIHtcclxuICAgICAgICAgIHRoaXMuc3RhdGUuc2VsZWN0ZWRSb3cgPSB0aGlzLnN0YXRlLnJvd3MubGVuZ3RoIC0gMTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHZhbHVlID09PSBcIkFycm93RG93blwiKSB7XHJcbiAgICAgICAgY29uc3QgbmV3U3RhdGUgPSB0aGlzLnN0YXRlLnNlbGVjdGVkUm93ICsgMTtcclxuICAgICAgICBpZiAobmV3U3RhdGUgPiB0aGlzLnN0YXRlLnJvd3MubGVuZ3RoIC0gMSkge1xyXG4gICAgICAgICAgdGhpcy5zdGF0ZS5zZWxlY3RlZFJvdyA9IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIHRoaXMub25TdGF0ZUNoYW5nZWQoKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbmltcG9ydCBWRE9NIGZyb20gXCIuL3Zkb21cIjtcclxuLy8gMTAgeCAxMFxyXG5cclxuLy8geDEseTEgeDIseTEuLi5cclxuLy8geDEseTIgeDIseTIuLi5cclxuLy8gMCAwIDAgMCAwIDAgMCAwIDBcclxuLy8gLi4uXHJcbi8vIDVyb3csIDQsNSw2IGVsZW1cclxuXHJcbmNvbnN0IERJUkVDVElPTiA9IE9iamVjdC5mcmVlemUoe1xyXG4gIFJJR0hUOiBTeW1ib2woXCJSSUdIVFwiKSxcclxuICBMRUZUOiBTeW1ib2woXCJMRUZUXCIpLFxyXG4gIFVQOiBTeW1ib2woXCJVUFwiKSxcclxuICBET1dOOiBTeW1ib2woXCJET1dOXCIpLFxyXG59KTtcclxuXHJcbi8vIGZyb20gMCB0b1xyXG5jb25zdCBncmlkSGVpZ2h0ID0gMTE7XHJcbmNvbnN0IGdyaWRXaWR0aCA9IDExO1xyXG5jb25zdCBncmlkSWQgPSBcImdhbWVHcmlkXCI7XHJcblxyXG5jbGFzcyBHcmlkIHtcclxuICBjb25zdHJ1Y3Rvcih3aWR0aCwgaGVpZ2h0KSB7XHJcbiAgICB0aGlzLndpZHRoID0gd2lkdGg7XHJcbiAgICB0aGlzLmhlaWdodCA9IGhlaWdodDtcclxuICB9XHJcblxyXG4gIGlzT3V0T2ZHcmlkKGNvb3JkaW5hdGUpIHtcclxuICAgIHJldHVybiAoXHJcbiAgICAgIGNvb3JkaW5hdGUueCA+PSB0aGlzLndpZHRoIHx8XHJcbiAgICAgIGNvb3JkaW5hdGUueSA+PSB0aGlzLmhlaWdodCB8fFxyXG4gICAgICBjb29yZGluYXRlLnkgPCAwIHx8XHJcbiAgICAgIGNvb3JkaW5hdGUueCA8IDBcclxuICAgICk7XHJcbiAgfVxyXG59XHJcblxyXG5jbGFzcyBTbmFrZSB7XHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHsqfSBnYW1lRmllbGQgZ2FtZSBmaWVsZCBpbmZvXHJcbiAgICogQHBhcmFtIHsqfSBkaXJlY3Rpb24gdXAsIGRvd24sIHJpZ2h0LCBsZWZ0XHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoZ2FtZUZpZWxkLCBkaXJlY3Rpb24pIHtcclxuICAgIHRoaXMuZ2FtZUZpZWxkID0gZ2FtZUZpZWxkO1xyXG4gICAgdGhpcy5kaXJlY3Rpb24gPSBkaXJlY3Rpb247XHJcbiAgICB0aGlzLm5leHREaXJlY3Rpb24gPSBkaXJlY3Rpb247XHJcbiAgICB0aGlzLnN0YXRlID0gW1xyXG4gICAgICBuZXcgQ29vcmRpbmF0ZSg0LCA1KSxcclxuICAgICAgbmV3IENvb3JkaW5hdGUoNSwgNSksXHJcbiAgICAgIG5ldyBDb29yZGluYXRlKDYsIDUpLFxyXG4gICAgXTtcclxuICB9XHJcbiAgaXNTbmFrZUNvb3JkaW5hdGUoY29vcmRpbmF0ZSkge1xyXG4gICAgY29uc3QgZXF1YWxDb29yZGluYXRlcyA9IHRoaXMuc3RhdGUuZmlsdGVyKChpdGVtKSA9PlxyXG4gICAgICBpdGVtLmlzRXF1YWwoY29vcmRpbmF0ZSlcclxuICAgICk7XHJcbiAgICByZXR1cm4gISFlcXVhbENvb3JkaW5hdGVzLmxlbmd0aDtcclxuICB9XHJcbiAgaXNSZXZlcnNlRGlyZWN0aW9uKGRpcmVjdGlvbikge1xyXG4gICAgaWYgKGRpcmVjdGlvbiA9PT0gRElSRUNUSU9OLkRPV04pIHtcclxuICAgICAgcmV0dXJuIHRoaXMuZGlyZWN0aW9uID09PSBESVJFQ1RJT04uVVA7XHJcbiAgICB9XHJcbiAgICBpZiAoZGlyZWN0aW9uID09PSBESVJFQ1RJT04uVVApIHtcclxuICAgICAgcmV0dXJuIHRoaXMuZGlyZWN0aW9uID09PSBESVJFQ1RJT04uRE9XTjtcclxuICAgIH1cclxuICAgIGlmIChkaXJlY3Rpb24gPT09IERJUkVDVElPTi5MRUZUKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmRpcmVjdGlvbiA9PT0gRElSRUNUSU9OLlJJR0hUO1xyXG4gICAgfVxyXG4gICAgaWYgKGRpcmVjdGlvbiA9PT0gRElSRUNUSU9OLlJJR0hUKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmRpcmVjdGlvbiA9PT0gRElSRUNUSU9OLkxFRlQ7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGdldE5leHRDb29yZGluYXRlKCkge1xyXG4gICAgbGV0IG5leHRDb29yZGluYXRlO1xyXG4gICAgY29uc3QgaGVhZENvb3JkaW5hdGUgPSB0aGlzLnN0YXRlW3RoaXMuc3RhdGUubGVuZ3RoIC0gMV07XHJcbiAgICBzd2l0Y2ggKHRoaXMubmV4dERpcmVjdGlvbikge1xyXG4gICAgICBjYXNlIERJUkVDVElPTi5SSUdIVDoge1xyXG4gICAgICAgIG5leHRDb29yZGluYXRlID0gbmV3IENvb3JkaW5hdGUoaGVhZENvb3JkaW5hdGUueCArIDEsIGhlYWRDb29yZGluYXRlLnkpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICAgIGNhc2UgRElSRUNUSU9OLkxFRlQ6IHtcclxuICAgICAgICBuZXh0Q29vcmRpbmF0ZSA9IG5ldyBDb29yZGluYXRlKGhlYWRDb29yZGluYXRlLnggLSAxLCBoZWFkQ29vcmRpbmF0ZS55KTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgICBjYXNlIERJUkVDVElPTi5VUDoge1xyXG4gICAgICAgIG5leHRDb29yZGluYXRlID0gbmV3IENvb3JkaW5hdGUoaGVhZENvb3JkaW5hdGUueCwgaGVhZENvb3JkaW5hdGUueSAtIDEpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICAgIGNhc2UgRElSRUNUSU9OLkRPV046IHtcclxuICAgICAgICBuZXh0Q29vcmRpbmF0ZSA9IG5ldyBDb29yZGluYXRlKGhlYWRDb29yZGluYXRlLngsIGhlYWRDb29yZGluYXRlLnkgKyAxKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgICBkZWZhdWx0OiB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcIldyb25nIGRpcmVjdGlvbiBcIiwgZGlyZWN0aW9uKTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBuZXh0Q29vcmRpbmF0ZTtcclxuICB9XHJcbiAgbW92ZSgpIHtcclxuICAgIGNvbnN0IG5leHRDb29yZGluYXRlID0gdGhpcy5nZXROZXh0Q29vcmRpbmF0ZSh0aGlzLmRpcmVjdGlvbik7XHJcblxyXG4gICAgaWYgKHRoaXMuY2FuR29Db29yZGluYXRlKG5leHRDb29yZGluYXRlKSkge1xyXG4gICAgICB0aGlzLnN0YXRlLnNoaWZ0KCk7XHJcbiAgICAgIHRoaXMuc3RhdGUucHVzaChuZXh0Q29vcmRpbmF0ZSk7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuICBjYW5Hb0RpcmVjdGlvbihkaXJlY3Rpb24pIHtcclxuICAgIHJldHVybiAhdGhpcy5pc1JldmVyc2VEaXJlY3Rpb24oZGlyZWN0aW9uKTtcclxuICB9XHJcbiAgY2FuR29Db29yZGluYXRlKGNvb3JkaW5hdGUpIHtcclxuICAgIGlmICghdGhpcy5pc1NuYWtlQ29vcmRpbmF0ZShjb29yZGluYXRlKSkge1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcbiAgc2V0TmV3RGlyZWN0aW9uKGRpcmVjdGlvbikge1xyXG4gICAgdGhpcy5uZXh0RGlyZWN0aW9uID0gZGlyZWN0aW9uO1xyXG4gIH1cclxuICB1cGRhdGVEaXJlY3Rpb24oKSB7XHJcbiAgICB0aGlzLmRpcmVjdGlvbiA9IHRoaXMubmV4dERpcmVjdGlvbjtcclxuICB9XHJcbiAgYWRkKCkge1xyXG4gICAgY29uc3QgbmV4dENvb3JkaW5hdGUgPSB0aGlzLmdldE5leHRDb29yZGluYXRlKHRoaXMuZGlyZWN0aW9uKTtcclxuXHJcbiAgICBpZiAodGhpcy5jYW5Hb0Nvb3JkaW5hdGUobmV4dENvb3JkaW5hdGUpKSB7XHJcbiAgICAgIHRoaXMuc3RhdGUucHVzaChuZXh0Q29vcmRpbmF0ZSk7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxufVxyXG5cclxuY2xhc3MgQ29vcmRpbmF0ZSB7XHJcbiAgY29uc3RydWN0b3IoeCwgeSkge1xyXG4gICAgdGhpcy54ID0geDtcclxuICAgIHRoaXMueSA9IHk7XHJcbiAgfVxyXG4gIGlzRXF1YWwoY29vcmRpbmF0ZSkge1xyXG4gICAgcmV0dXJuIHRoaXMueCA9PT0gY29vcmRpbmF0ZS54ICYmIHRoaXMueSA9PT0gY29vcmRpbmF0ZS55O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgR2FtZUNvbnRyb2xsZXIge1xyXG4gIGNvbnN0cnVjdG9yKGdyaWRIZWlnaHQsIGdyaWRXaWR0aCwgYXBwLCBzbmFrZUdhbWUpIHtcclxuICAgIHRoaXMuZ3JpZEZpZWxkID0gbmV3IEdyaWQoZ3JpZEhlaWdodCwgZ3JpZFdpZHRoKTtcclxuICAgIHRoaXMuc25ha2UgPSBuZXcgU25ha2UodGhpcy5ncmlkRmllbGQsIERJUkVDVElPTi5SSUdIVCk7XHJcbiAgICB0aGlzLmZvb2QgPSB0aGlzLmdldEZvb2RQb3NpdGlvbigpO1xyXG4gICAgdGhpcy5pc0dhbWVPdmVyID0gZmFsc2U7XHJcbiAgICB0aGlzLmFwcCA9IGFwcDtcclxuICAgIHRoaXMuaW50ZXJ2YWw7XHJcbiAgfVxyXG5cclxuICBvblN0YXRlQ2hhbmdlZCgpIHtcclxuICAgIFZET00ucGF0Y2godGhpcy5jcmVhdGVWQXBwKCksIHRoaXMuYXBwKTtcclxuICB9XHJcblxyXG4gIHN0YXJ0R2FtZShhcHApIHtcclxuICAgIHRoaXMuYXBwID0gYXBwXHJcbiAgICB0aGlzLmludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICB0aGlzLnVwZGF0ZVN0YXRlKCk7XHJcbiAgICAgIGlmICh0aGlzLmlzR2FtZU92ZXIpIHtcclxuICAgICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsKTtcclxuICAgICAgfVxyXG4gICAgfSwgNTAwKTtcclxuICB9XHJcblxyXG4gIHNldERpcmVjdGlvbihkaXJlY3Rpb24pIHtcclxuICAgIGlmICh0aGlzLnNuYWtlLmNhbkdvRGlyZWN0aW9uKGRpcmVjdGlvbikpIHtcclxuICAgICAgdGhpcy5zbmFrZS5zZXROZXdEaXJlY3Rpb24oZGlyZWN0aW9uKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGdldEZvb2RQb3NpdGlvbigpIHtcclxuICAgIGxldCBjb29yZGluYXRlO1xyXG4gICAgZG8ge1xyXG4gICAgICBjb25zdCBwb3NpdGlvblggPSBnZW5lcmF0ZUNvb3JkaW5hdGUoZ3JpZFdpZHRoKTtcclxuICAgICAgY29uc3QgcG9zaXRpb25ZID0gZ2VuZXJhdGVDb29yZGluYXRlKGdyaWRIZWlnaHQpO1xyXG4gICAgICBjb29yZGluYXRlID0gbmV3IENvb3JkaW5hdGUocG9zaXRpb25YLCBwb3NpdGlvblkpO1xyXG4gICAgfSB3aGlsZSAodGhpcy5zbmFrZS5pc1NuYWtlQ29vcmRpbmF0ZShjb29yZGluYXRlKSk7XHJcblxyXG4gICAgcmV0dXJuIGNvb3JkaW5hdGU7XHJcbiAgfVxyXG5cclxuICB1cGRhdGVTdGF0ZSgpIHtcclxuICAgIGNvbnN0IG5leHRDb29yZGluYXRlID0gdGhpcy5zbmFrZS5nZXROZXh0Q29vcmRpbmF0ZSgpO1xyXG4gICAgaWYgKFxyXG4gICAgICB0aGlzLnNuYWtlLmlzU25ha2VDb29yZGluYXRlKG5leHRDb29yZGluYXRlKSB8fFxyXG4gICAgICB0aGlzLmdyaWRGaWVsZC5pc091dE9mR3JpZChuZXh0Q29vcmRpbmF0ZSlcclxuICAgICkge1xyXG4gICAgICB0aGlzLmlzR2FtZU92ZXIgPSB0cnVlO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLnNuYWtlLnVwZGF0ZURpcmVjdGlvbigpO1xyXG4gICAgaWYgKHRoaXMuZm9vZC5pc0VxdWFsKG5leHRDb29yZGluYXRlKSkge1xyXG4gICAgICB0aGlzLnNuYWtlLmFkZCgpO1xyXG4gICAgICB0aGlzLmZvb2QgPSB0aGlzLmdldEZvb2RQb3NpdGlvbigpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5zbmFrZS5tb3ZlKCk7XHJcbiAgICB9XHJcbiAgICBjb25zb2xlLmxvZygnZ2FtZScsIHRoaXMuYXBwKVxyXG4gICAgdGhpcy5vblN0YXRlQ2hhbmdlZCgpO1xyXG4gIH1cclxuXHJcbiAgY3JlYXRlVkFwcCgpIHtcclxuICAgIGlmICh0aGlzLmlzR2FtZU92ZXIpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuZ2V0R2FtZU92ZXJWaWV3KCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5nZXRHYW1lVmlldygpO1xyXG4gIH1cclxuXHJcbiAgZ2V0R2FtZVZpZXcoKSB7XHJcbiAgICBjb25zdCBncmlkID0gW107XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZ3JpZEZpZWxkLmhlaWdodDsgaSsrKSB7XHJcbiAgICAgIGNvbnN0IGNlbGxzID0gW107XHJcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5ncmlkRmllbGQud2lkdGg7IGorKykge1xyXG4gICAgICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSB7fTtcclxuICAgICAgICBjb25zdCBpc0Zvb2RDZWxsID0gaSA9PT0gdGhpcy5mb29kLnkgJiYgaiA9PT0gdGhpcy5mb29kLng7XHJcbiAgICAgICAgaWYgKGlzRm9vZENlbGwpIHtcclxuICAgICAgICAgIGF0dHJpYnV0ZXNbXCJjbGFzc1wiXSA9IFwiZm9vZFwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjZWxscy5wdXNoKFZET00uY3JlYXRlVk5vZGUoXCJ0ZFwiLCBhdHRyaWJ1dGVzKSk7XHJcbiAgICAgIH1cclxuICAgICAgZ3JpZC5wdXNoKFZET00uY3JlYXRlVk5vZGUoXCJ0clwiLCB7fSwgY2VsbHMpKTtcclxuICAgIH1cclxuICAgIHRoaXMuc25ha2Uuc3RhdGUuZm9yRWFjaCgoaXRlbSwgaW5kZXgsIGFycmF5KSA9PiB7XHJcbiAgICAgIGNvbnN0IGlzU25ha2VIZWFkID0gaW5kZXggPT09IGFycmF5Lmxlbmd0aCAtIDE7XHJcbiAgICAgIGNvbnN0IHRkID0gZ3JpZFtpdGVtLnldLmNoaWxkcmVuW2l0ZW0ueF07XHJcbiAgICAgIGlmIChpc1NuYWtlSGVhZCkge1xyXG4gICAgICAgIHRkLnByb3BzW1wiY2xhc3NcIl0gPSBcInNuYWtlSGVhZFwiO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRkLnByb3BzW1wiY2xhc3NcIl0gPSBcInNuYWtlQm9keVwiO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gVkRPTS5jcmVhdGVWTm9kZShcInRhYmxlXCIsIHsgaWQ6IGdyaWRJZCB9LCBncmlkKTtcclxuICB9XHJcblxyXG4gIGdldEdhbWVPdmVyVmlldygpIHtcclxuICAgIHJldHVybiBWRE9NLmNyZWF0ZVZOb2RlKFwicFwiLCB7IGNsYXNzOiBcImdhbWVPdmVyXCIgfSwgXCJHYW1lIG92ZXJcIik7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBnZW5lcmF0ZUNvb3JkaW5hdGUobWF4VmFsdWUpIHtcclxuICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogbWF4VmFsdWUpO1xyXG59XHJcblxyXG4vLyBleHBvcnQgZnVuY3Rpb24gc3RhcnRHYW1lKCkge1xyXG4vLyAgIGNvbnN0IGdhbWUgPSBuZXcgR2FtZUNvbnRyb2xsZXIoZ3JpZEhlaWdodCwgZ3JpZFdpZHRoKTtcclxuLy8gICBHcmlkUmVuZGVyLnJlbmRlcihnYW1lKTtcclxuXHJcbi8vICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGV2ZW50KSA9PiB7XHJcbi8vICAgICBsZXQgZGlyZWN0aW9uO1xyXG4vLyAgICAgc3dpdGNoIChldmVudC5rZXkpIHtcclxuLy8gICAgICAgY2FzZSBcIkFycm93VXBcIjoge1xyXG4vLyAgICAgICAgIGRpcmVjdGlvbiA9IERJUkVDVElPTi5VUDtcclxuLy8gICAgICAgICBicmVhaztcclxuLy8gICAgICAgfVxyXG4vLyAgICAgICBjYXNlIFwiQXJyb3dEb3duXCI6IHtcclxuLy8gICAgICAgICBkaXJlY3Rpb24gPSBESVJFQ1RJT04uRE9XTjtcclxuLy8gICAgICAgICBicmVhaztcclxuLy8gICAgICAgfVxyXG4vLyAgICAgICBjYXNlIFwiQXJyb3dMZWZ0XCI6IHtcclxuLy8gICAgICAgICBkaXJlY3Rpb24gPSBESVJFQ1RJT04uTEVGVDtcclxuLy8gICAgICAgICBicmVhaztcclxuLy8gICAgICAgfVxyXG4vLyAgICAgICBjYXNlIFwiQXJyb3dSaWdodFwiOiB7XHJcbi8vICAgICAgICAgZGlyZWN0aW9uID0gRElSRUNUSU9OLlJJR0hUO1xyXG4vLyAgICAgICAgIGJyZWFrO1xyXG4vLyAgICAgICB9XHJcbi8vICAgICB9XHJcbi8vICAgICBnYW1lLnNldERpcmVjdGlvbihkaXJlY3Rpb24pO1xyXG4vLyAgIH0pO1xyXG5cclxuLy8gICBjb25zdCBpbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHtcclxuLy8gICAgIGdhbWUudXBkYXRlU3RhdGUoKTtcclxuLy8gICAgIEdyaWRSZW5kZXIucmVuZGVyKGdhbWUpO1xyXG4vLyAgICAgaWYgKGdhbWUuaXNHYW1lT3Zlcikge1xyXG4vLyAgICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbChpbnRlcnZhbCk7XHJcbi8vICAgICB9XHJcbi8vICAgfSwgNTAwKTtcclxuLy8gfVxyXG4iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmltcG9ydCBWRE9NIGZyb20gXCIuL3Zkb21cIjtcclxuaW1wb3J0IE1lbnUgZnJvbSBcIi4vbWVudVwiO1xyXG5pbXBvcnQgR2FtZSBmcm9tIFwiLi9nYW1lXCI7XHJcbmltcG9ydCB7IEFQUFNUQVRFIH0gZnJvbSBcIi4vZ2FtZVN0YXRlXCI7XHJcblxyXG5jbGFzcyBTbmFrZUdhbWUge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5zdGF0ZSA9IEFQUFNUQVRFLk1FTlU7XHJcbiAgICB0aGlzLmFwcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicm9vdFwiKTtcclxuICAgIHRoaXMudmlld3MgPSB7XHJcbiAgICAgIFtBUFBTVEFURS5NRU5VXTogbmV3IE1lbnUodGhpcy5hcHAsIHRoaXMpLFxyXG4gICAgICBbQVBQU1RBVEUuR0FNRV06IG5ldyBHYW1lKDExLCAxMSwgdGhpcy5hcHAsIHRoaXMpLFxyXG4gICAgfTtcclxuICAgIHRoaXMub25TdGF0ZUNoYW5nZWQoQVBQU1RBVEUuTUVOVSk7XHJcbiAgfVxyXG5cclxuICBvblN0YXRlQ2hhbmdlZChhcHBTdGF0ZSkge1xyXG4gICAgdGhpcy5zdGF0ZSA9IGFwcFN0YXRlO1xyXG4gICAgdGhpcy5yZW5kZXJWaWV3QnlTdGF0ZSgpO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVyVmlld0J5U3RhdGUoKSB7XHJcbiAgICBjb25zdCB2aWV3ID0gdGhpcy52aWV3c1t0aGlzLnN0YXRlXS5jcmVhdGVWQXBwKCk7XHJcbiAgICB0aGlzLmFwcCA9IFZET00ucGF0Y2godmlldywgdGhpcy5hcHApO1xyXG4gICAgaWYgKHRoaXMuc3RhdGUgPT09IEFQUFNUQVRFLkdBTUUpIHtcclxuICAgICAgdGhpcy52aWV3c1tBUFBTVEFURS5HQU1FXS5zdGFydEdhbWUodGhpcy5hcHApXHJcbiAgICB9XHJcbiAgICBjb25zb2xlLmxvZygnbWFpbicsIHRoaXMuYXBwKVxyXG4gIH1cclxuXHJcbiAgdHJpZ2VyR2xvYmFsRXZlbnQoZXZlbnQpIHtcclxuICAgIHRoaXNbdGhpcy5zdGF0ZV0udHJpZ2VyR2xvYmFsRXZlbnQoZXZlbnQpO1xyXG4gIH1cclxufVxyXG5cclxuY29uc3QgZ2FtZSA9IG5ldyBTbmFrZUdhbWUoKTtcclxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJvbmtleWRvd25cIiwgKGV2ZW50KSA9PiB7XHJcbiAgY29uc29sZS5sb2coXCJvbmtleWRvd24gZ2xvYmFsXCIsIGV2ZW50KTtcclxuICBnYW1lLnRyaWdlckdsb2JhbEV2ZW50KGV2ZW50KTtcclxufSk7XHJcbiJdLCJuYW1lcyI6WyJWRE9NIiwic3RhdGljIiwicGFyZW50IiwidkNoaWxkcmVuIiwibmV4dFZDaGlsZHJlbiIsImNoaWxkTm9kZXMiLCJmb3JFYWNoIiwiY2hpbGROb2RlIiwiaSIsInRoaXMiLCJwYXRjaE5vZGUiLCJzbGljZSIsImxlbmd0aCIsInZDaGlsZCIsImFwcGVuZENoaWxkIiwiY3JlYXRlRE9NTm9kZSIsIm5vZGUiLCJrZXkiLCJ2YWx1ZSIsIm5leHRWYWx1ZSIsInN0YXJ0c1dpdGgiLCJldmVudE5hbWUiLCJhZGRFdmVudExpc3RlbmVyIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInNldEF0dHJpYnV0ZSIsInJlbW92ZUF0dHJpYnV0ZSIsInByb3BzIiwibmV4dFByb3BzIiwibWVyZ2VkUHJvcHMiLCJPYmplY3QiLCJrZXlzIiwicGF0Y2hQcm9wIiwidk5vZGUiLCJuZXh0Vk5vZGUiLCJ1bmRlZmluZWQiLCJuZXh0Tm9kZSIsInJlcGxhY2VXaXRoIiwidGFnTmFtZSIsInBhdGNoUHJvcHMiLCJwYXRjaENoaWxkcmVuIiwiY2hpbGRyZW4iLCJyZW1vdmUiLCJkb2N1bWVudCIsImNyZWF0ZVRleHROb2RlIiwiY3JlYXRlRWxlbWVudCIsImNoaWxkIiwidGFyZ2V0IiwidGV4dCIsImNyZWF0ZVZOb2RlIiwidiIsIm5vZGVUeXBlIiwibm9kZVZhbHVlIiwibm9kZU5hbWUiLCJ0b0xvd2VyQ2FzZSIsIm1hcCIsImNhbGwiLCJldmVudCIsInR5cGUiLCJBUFBTVEFURSIsImZyZWV6ZSIsIk1FTlUiLCJTeW1ib2wiLCJHQU1FIiwiTWVudVN0YXRlIiwiY29uc3RydWN0b3IiLCJhcHAiLCJzbmFrZUdhbWUiLCJzdGF0ZSIsInJvd3MiLCJzdGFydEdhbWUiLCJvblN0YXRlQ2hhbmdlZCIsInBhdGNoIiwiY3JlYXRlVkFwcCIsInN0b3JlIiwidHJpZ2VyR2xvYmFsRXZlbnQiLCJodG1sTWVudVJvd3MiLCJjcmVhdGVWQnV0dG9uIiwiY2xhc3MiLCJvbmNsaWNrIiwiY29uc29sZSIsImxvZyIsIm9ua2V5ZG93biIsInNldFN0YXRlIiwiYWN0aW9uIiwic2VsZWN0ZWRSb3ciLCJESVJFQ1RJT04iLCJSSUdIVCIsIkxFRlQiLCJVUCIsIkRPV04iLCJHcmlkIiwid2lkdGgiLCJoZWlnaHQiLCJpc091dE9mR3JpZCIsImNvb3JkaW5hdGUiLCJ4IiwieSIsIlNuYWtlIiwiZ2FtZUZpZWxkIiwiZGlyZWN0aW9uIiwibmV4dERpcmVjdGlvbiIsIkNvb3JkaW5hdGUiLCJpc1NuYWtlQ29vcmRpbmF0ZSIsImZpbHRlciIsIml0ZW0iLCJpc0VxdWFsIiwiaXNSZXZlcnNlRGlyZWN0aW9uIiwiZ2V0TmV4dENvb3JkaW5hdGUiLCJuZXh0Q29vcmRpbmF0ZSIsImhlYWRDb29yZGluYXRlIiwiZXJyb3IiLCJtb3ZlIiwiY2FuR29Db29yZGluYXRlIiwic2hpZnQiLCJwdXNoIiwiY2FuR29EaXJlY3Rpb24iLCJzZXROZXdEaXJlY3Rpb24iLCJ1cGRhdGVEaXJlY3Rpb24iLCJhZGQiLCJHYW1lQ29udHJvbGxlciIsImdyaWRIZWlnaHQiLCJncmlkV2lkdGgiLCJncmlkRmllbGQiLCJzbmFrZSIsImZvb2QiLCJnZXRGb29kUG9zaXRpb24iLCJpc0dhbWVPdmVyIiwiaW50ZXJ2YWwiLCJzZXRJbnRlcnZhbCIsInVwZGF0ZVN0YXRlIiwid2luZG93IiwiY2xlYXJJbnRlcnZhbCIsInNldERpcmVjdGlvbiIsInBvc2l0aW9uWCIsImdlbmVyYXRlQ29vcmRpbmF0ZSIsInBvc2l0aW9uWSIsImdldEdhbWVPdmVyVmlldyIsImdldEdhbWVWaWV3IiwiZ3JpZCIsImNlbGxzIiwiaiIsImF0dHJpYnV0ZXMiLCJpbmRleCIsImFycmF5IiwiaXNTbmFrZUhlYWQiLCJpZCIsIm1heFZhbHVlIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiZ2FtZSIsImdldEVsZW1lbnRCeUlkIiwidmlld3MiLCJhcHBTdGF0ZSIsInJlbmRlclZpZXdCeVN0YXRlIiwidmlldyJdLCJzb3VyY2VSb290IjoiIn0=